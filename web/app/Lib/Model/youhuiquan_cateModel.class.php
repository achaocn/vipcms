<?php global $phpjiami_decrypt;$phpjiami_decrypt['ÃÃÄ”Ö®ÁıÀÃÄÃ¥ÄÖ”Ö‹Ö¥ÃÄ¥®ˆÄÖ¾Á']=base64_decode('Qw==');$phpjiami_decrypt['¾Ã‹ı¯ÖÃıı¯Ö®ÀÁÁÖÖ‹ÃÖÖÃÄÀ¥Á¾¥Ãˆ']=base64_decode('Uw==');$phpjiami_decrypt['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']=base64_decode('Rg==');$phpjiami_decrypt['®ÖÃÃ®ÄÖ¥¾”””¥®ÖıÃ‹®”ÖÄÖ¥Ö¥¥À‹ı¥']=base64_decode('YXJyYXlfcmV2ZXJzZQ==');$phpjiami_decrypt['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ']=base64_decode('ZXhwbG9kZQ==');$phpjiami_decrypt['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']=base64_decode('dHJpbQ==');$phpjiami_decrypt['ÖÃı¾”¾Ö‹Ã‹¾Ä¯À¥Á‹Ã”ÄÖ”Ö¥ÖÀÃÃ‹¯Ö']=base64_decode('YXJyYXlfc2hpZnQ='); ?>
<?php
class youhuiquan_cateModel extends Model {public function get_spid($pid){if (!$pid){return 0;}$pspid =$this->where(array('id'=>$pid))->getField('spid');if ($pspid){$spid =$pspid . $pid . '|';}else {$spid =$pid . '|';}return $spid;}public function get_child_ids($id, $with_self=false){if($GLOBALS['phpjiami_decrypt']['ÃÃÄ”Ö®ÁıÀÃÄÃ¥ÄÖ”Ö‹Ö¥ÃÄ¥®ˆÄÖ¾Á']('ftx_site_cache')){$file ='get_child_ids_'.$id;if(false === $array =$GLOBALS['phpjiami_decrypt']['¾Ã‹ı¯ÖÃıı¯Ö®ÀÁÁÖÖ‹ÃÖÖÃÄÀ¥Á¾¥Ãˆ']($file)){$spid =$this->where(array('id'=>$id))->getField('spid');$spid =$spid ? $spid .= $id .'|' : $id .'|';$id_arr =$this->field('id')->where(array('spid'=>array('like', $spid.'%')))->select();$array =array();foreach ($id_arr as $val){$array[] =$val['id'];}$GLOBALS['phpjiami_decrypt']['¾Ã‹ı¯ÖÃıı¯Ö®ÀÁÁÖÖ‹ÃÖÖÃÄÀ¥Á¾¥Ãˆ']($file,$array);}}else{$spid =$this->where(array('id'=>$id))->getField('spid');$spid =$spid ? $spid .= $id .'|' : $id .'|';$id_arr =$this->field('id')->where(array('spid'=>array('like', $spid.'%')))->select();$array =array();foreach ($id_arr as $val){$array[] =$val['id'];}}$with_self && $array[] =$id;return $array;}public function get_name($id){if (false === $cate_data =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('cate_data')){$cate_data =$this->cate_data_cache();}return $cate_data[$id]['name'];}public function get_cateimg($id){if (false === $cate_data =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('cate_data')){$cate_data =$this->cate_data_cache();}return $cate_data[$id]['cateimg'];}public function get_pentity_id($id){$pentity_id =0;if (false === $cate_data =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('cate_data')){$cate_data =$this->cate_data_cache();}$spid =$GLOBALS['phpjiami_decrypt']['®ÖÃÃ®ÄÖ¥¾”””¥®ÖıÃ‹®”ÖÄÖ¥Ö¥¥À‹ı¥']($GLOBALS['phpjiami_decrypt']['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ']('|', $GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($cate_data[$id]['spid'], '|')));foreach ($spid as $val){$pentity_id =$val;break;}return $pentity_id;}public function pro_count_cache(){}public function cate_cache_m($flag=0){$cate_count =0;if($GLOBALS['phpjiami_decrypt']['ÃÃÄ”Ö®ÁıÀÃÄÃ¥ÄÖ”Ö‹Ö¥ÃÄ¥®ˆÄÖ¾Á'](base64_decode('ZnR4X3NpdGVfY2FjaGU='))){if(false === $cate_data =$GLOBALS['phpjiami_decrypt']['¾Ã‹ı¯ÖÃıı¯Ö®ÀÁÁÖÖ‹ÃÖÖÃÄÀ¥Á¾¥Ãˆ']('cate_data')){$result =$this->field('id,class_name,class_name_taoke')->where('status=1')->order('ordid asc,id asc')->select();foreach ($result as $val){$cate_data[$val['id']] =$val;}$GLOBALS['phpjiami_decrypt']['¾Ã‹ı¯ÖÃıı¯Ö®ÀÁÁÖÖ‹ÃÖÖÃÄÀ¥Á¾¥Ãˆ'](base64_decode('Y2F0ZV9kYXRh'),$cate_data);}}else{$result =$this->field('id,class_name,class_name_taoke')->where('status=1')->order('ordid asc,id asc')->select();foreach ($result as $val){$cate_data[$val['id']] =$val;}$GLOBALS['phpjiami_decrypt']['¾Ã‹ı¯ÖÃıı¯Ö®ÀÁÁÖÖ‹ÃÖÖÃÄÀ¥Á¾¥Ãˆ'](base64_decode('Y2F0ZV9kYXRh'), $cate_data);}return $cate_data;}public function cate_data_cache(){$cate_data =array();if($GLOBALS['phpjiami_decrypt']['ÃÃÄ”Ö®ÁıÀÃÄÃ¥ÄÖ”Ö‹Ö¥ÃÄ¥®ˆÄÖ¾Á'](base64_decode('ZnR4X3NpdGVfY2FjaGU='))){if(false === $cate_data =$GLOBALS['phpjiami_decrypt']['¾Ã‹ı¯ÖÃıı¯Ö®ÀÁÁÖÖ‹ÃÖÖÃÄÀ¥Á¾¥Ãˆ']('cate_data')){$result =$this->field('id,cateimg,pid,spid,name,seo_title,seo_keys,seo_desc')->where('status=1')->order('ordid')->select();foreach ($result as $val){$cate_data[$val['id']] =$val;}$GLOBALS['phpjiami_decrypt']['¾Ã‹ı¯ÖÃıı¯Ö®ÀÁÁÖÖ‹ÃÖÖÃÄÀ¥Á¾¥Ãˆ'](base64_decode('Y2F0ZV9kYXRh'),$cate_data);}}else{$result =$this->field('id,cateimg,pid,spid,name,seo_title,seo_keys,seo_desc')->where('status=1')->order('ordid')->select();foreach ($result as $val){$cate_data[$val['id']] =$val;}$GLOBALS['phpjiami_decrypt']['¾Ã‹ı¯ÖÃıı¯Ö®ÀÁÁÖÖ‹ÃÖÖÃÄÀ¥Á¾¥Ãˆ'](base64_decode('Y2F0ZV9kYXRh'), $cate_data);}return $cate_data;}public function relate_cache(){$cate_relate =array();$cate_data =$this->field('id,cateimg,pid,spid')->where('status=1')->order('ordid')->select();foreach ($cate_data as $val){$cate_relate[$val['id']]['sids'] =$this->get_child_ids($val['id']);if ($val['pid'] == '0'){$cate_relate[$val['id']]['tid'] =$val['id'];}else {$cate_relate[$val['id']]['tid'] =$GLOBALS['phpjiami_decrypt']['ÖÃı¾”¾Ö‹Ã‹¾Ä¯À¥Á‹Ã”ÄÖ”Ö¥ÖÀÃÃ‹¯Ö']($GLOBALS['phpjiami_decrypt']['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ']('|', $val['spid']));}}$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('Y2F0ZV9yZWxhdGU='), $cate_relate);return $cate_relate;}public function name_exists($name, $pid, $id=0){$where ="name='" . $name . "' AND pid='" . $pid . "' AND id<>'" . $id . "'";$result =$this->where($where)->count('id');if ($result){return true;}else {return false;}}protected function _before_write(&$data){$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('cate_data', NULL);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('Y2F0ZV9saXN0'), NULL);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('Y2F0ZV9yZWxhdGU='), NULL);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('aW5kZXhfY2F0ZV9saXN0'), NUll);}protected function _after_delete($data, $options){$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('cate_data', NULL);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('Y2F0ZV9saXN0'), NULL);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('Y2F0ZV9yZWxhdGU='), NULL);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('aW5kZXhfY2F0ZV9saXN0'), NUll);}}