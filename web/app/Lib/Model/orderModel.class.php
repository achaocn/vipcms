<?php global $phpjiami_decrypt;$phpjiami_decrypt['ŽÁýýÃ¯¥‹¯‹®”ýÃ®ÃÁÄŽ”ÀŽÖ‹Ã¯ÖÖý¥Ö‹']=base64_decode('dGltZQ==');$phpjiami_decrypt['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']=base64_decode('TQ=='); ?>
<?php
class orderModel extends Model {public function checkTime(){$map['add_time'] =array('lt',$GLOBALS['phpjiami_decrypt']['ŽÁýýÃ¯¥‹¯‹®”ýÃ®ÃÁÄŽ”ÀŽÖ‹Ã¯ÖÖý¥Ö‹']()-(86400*3));$map['status'] ='å¾…å¡«å†™è®¢å•å·';$list =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']('order')->where($map)->select();foreach($list as $key => $val){$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']('free')->where("id = ".$val['items_id'])->setInc('remain',1);}$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý'](base64_decode('b3JkZXI='))->where($map)->delete();$where['order_time'] =array('lt',$GLOBALS['phpjiami_decrypt']['ŽÁýýÃ¯¥‹¯‹®”ýÃ®ÃÁÄŽ”ÀŽÖ‹Ã¯ÖÖý¥Ö‹']()-(86400*15));$where['status'] ='å¾…å®¡æ ¸è®¢å•å·';$data =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']('order')->where($where)->select();foreach($data as $key => $val){$result =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']('user')->where("id = ".$val['uid'])->setInc('money',$val['price']);$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý'](base64_decode('b3JkZXI='))->where(base64_decode('aWQgPQ==').$val['id'])->setField('status','å·²è¿”è¿˜');if($result){$finance['uid'] =$val['uid'];$finance['money'] =$val['price'];$finance['add_time'] =$GLOBALS['phpjiami_decrypt']['ŽÁýýÃ¯¥‹¯‹®”ýÃ®ÃÁÄŽ”ÀŽÖ‹Ã¯ÖÖý¥Ö‹']();$finance['memo'] =$val['title'].'è¿”è¿˜æ¬¾é¡¹ã€è‡ªåŠ¨ç¡®è®¤ã€‘';$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý'](base64_decode('ZmluYW5jZQ=='))->add($finance);}}}}