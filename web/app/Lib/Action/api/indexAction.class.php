<?php global $phpjiami_decrypt;$phpjiami_decrypt['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']=base64_decode('X2luaXRpYWxpemU=');$phpjiami_decrypt['”¯ÁÁÖ¥”ıÃˆ”¯Ä”ˆ¯ıÃÄÖ”ˆ¾ÖÖÀÀ¥']=base64_decode('c3RydG9sb3dlcg==');$phpjiami_decrypt['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']=base64_decode('SQ==');$phpjiami_decrypt['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']=base64_decode('dGltZQ==');$phpjiami_decrypt['ıÀÃıÖıÖÃ‹¥Ö¥¯Á®®¾ÖÖı‹®ˆÖÖ¯Öˆ”ÖÁ']=base64_decode('c29ydA==');$phpjiami_decrypt['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']=base64_decode('aW1wbG9kZQ==');$phpjiami_decrypt['Á¥ÀÖ¯ÄÁ¥¥ÖÃ‹¥®ÁÄÖˆÄÃ¾®Á¥À‹ÖÀ‹']=base64_decode('c2hhMQ==');$phpjiami_decrypt['”‹¥Ö¯Ö‹ıÁ®ÖÀ®¾¾ÄÖˆ®Ä¯”ı¾‹¾ÄÃıÃ']=base64_decode('aW50dmFs');$phpjiami_decrypt['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']=base64_decode('ZmlsZV9nZXRfY29udGVudHM=');$phpjiami_decrypt['ÃÃÄ”Ö®ÁıÀÃÄÃ¥ÄÖ”Ö‹Ö¥ÃÄ¥®ˆÄÖ¾Á']=base64_decode('Qw==');$phpjiami_decrypt['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']=base64_decode('TQ=='); ?>
<?php
class indexAction extends FrontAction {public function _initialize(){parent::$GLOBALS['phpjiami_decrypt']['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']();$this->_mod =D('youhuiquan');$this->_cate_mod =D('youhuiquan_cate');$local_sign =$this->generateSign();$client_sign =$GLOBALS['phpjiami_decrypt']['”¯ÁÁÖ¥”ıÃˆ”¯Ä”ˆ¯ıÃÄÖ”ˆ¾ÖÖÀÀ¥']($GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.sign',''));$timestamp =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.timestamp');if ($local_sign!=$GLOBALS['phpjiami_decrypt']['”¯ÁÁÖ¥”ıÃˆ”¯Ä”ˆ¯ıÃÄÖ”ˆ¾ÖÖÀÀ¥']($client_sign)){$this->ajaxReturn('599','ç­¾åé”™è¯¯');}if($GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()-$timestamp>300||$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()-$timestamp<=-5){$this->ajaxReturn('598','è¶…æ—¶äº†'.time()."--".$timestamp);}}public function generateSign(){$client ='soft';$key ='vipcms';$timestamp =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.timestamp');$nonce =$GLOBALS['phpjiami_decrypt']['”¯ÁÁÖ¥”ıÃˆ”¯Ä”ˆ¯ıÃÄÖ”ˆ¾ÖÖÀÀ¥']($GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.nonce'));$tmpArr =array($client,$key,$timestamp,$nonce);$GLOBALS['phpjiami_decrypt']['ıÀÃıÖıÖÃ‹¥Ö¥¯Á®®¾ÖÖı‹®ˆÖÖ¯Öˆ”ÖÁ']($tmpArr);$string =$GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']($tmpArr);$signature =$GLOBALS['phpjiami_decrypt']['Á¥ÀÖ¯ÄÁ¥¥ÖÃ‹¥®ÁÄÖˆÄÃ¾®Á¥À‹ÖÀ‹']($string);return $signature;}public function getinfo(){$this->ajaxReturn(600, 'è·å–æ•°æ®æˆåŠŸ', C('ftx_yhq_pid'),C('ftx_site_secret'));}public function get_pro(){$id=$GLOBALS['phpjiami_decrypt']['”‹¥Ö¯Ö‹ıÁ®ÖÀ®¾¾ÄÖˆ®Ä¯”ı¾‹¾ÄÃıÃ']($GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('id'));$where=' pass=1';if(!empty($id)){$where.=' and id<'.$id;}$per=$GLOBALS['phpjiami_decrypt']['”‹¥Ö¯Ö‹ıÁ®ÖÀ®¾¾ÄÖˆ®Ä¯”ı¾‹¾ÄÃıÃ']($GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('per'));$per=$per?$per:100;$datalist=$this->_mod->where($where)->field('id,taobao_id,quan_link')->order('id desc')->limit($per)->select();if($datalist){$this->ajaxReturn(600, 'è·å–æ•°æ®æˆåŠŸ', $datalist);}else {$this->ajaxReturn(601, 'æ²¡æœ‰æ•°æ®äº†');}}public function put_pro(){$json =$GLOBALS['phpjiami_decrypt']['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']("php://input");$con=json_decode($json,true);$sql='';if($con){foreach($con as $k=>$item){if(empty($item['price_order'])||$item['price_order']==0.00||$item['price_order']<0){$ids[]=$item['id'];}if(empty($item['price_youhui'])||$item['price_youhui']==0.00||$item['price_youhui']<0){$ids[]=$item['id'];}if(empty($item['price_youhuiquan'])||$item['price_youhuiquan']==0.00||$item['price_youhuiquan']<0){$ids[]=$item['id'];}$sql.='update '.$GLOBALS['phpjiami_decrypt']['ÃÃÄ”Ö®ÁıÀÃÄÃ¥ÄÖ”Ö‹Ö¥ÃÄ¥®ˆÄÖ¾Á']('DB_PREFIX').'_youhuiquan set price_order='.$item['price_order'].',price_youhui='.$item['price_youhui'].',price_youhuiquan='.$item['price_youhuiquan'].',commission_rate='.$item['commission_rate'].',quan_num_zong='.$item['quan_num_zong'].',quan_num_ling='.$item['quan_num_ling'].',quan_num_shengyu='.$item['quan_num_shengyu'].',commission_type='.$item['commission_type'].',sales='.$item['sales'];if($item['price_youhui']<=8.8){$sql.=',cid=1';}elseif($item['price_youhui']<=20){$sql.=',cid=2';}else {$sql.=',cid=0';}$sql.=' where id='.$item['id'].';';}if(!empty($sql)){$mysqli=new mysqli(C('DB_HOST'),C('DB_USER'),C('DB_PWD'),C('DB_NAME'));$res=$mysqli->multi_query($sql);}if(!empty($ids)){$idsstr=$GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ'](",",$ids);$res1=$this->_mod->delete($idsstr);}if($res||$res1){$this->ajaxReturn(600, 'æ›´æ”¹æˆåŠŸ');}else {$this->ajaxReturn(601, 'æ›´æ”¹å¤±è´¥');}}else {$this->ajaxReturn(602, 'æ²¡æœ‰æ¥æ”¶æ•°æ®');}}public function del_pro(){$flag=$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('post.flag');if($flag=='gq'){$where='end_time<'.$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']();}elseif($flag=='isz'){$where='change=2';}elseif($flag=='all'){$where='1';}$res=$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('youhuiquan')->where($where)->delete();if($res){$this->ajaxReturn(600, 'å·²æ¸…ç†');}else {$this->ajaxReturn(601, 'æ¸…ç†å¤±è´¥');}}public function savepro(){$json =$GLOBALS['phpjiami_decrypt']['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']("php://input");$con=json_decode($json,true);$i=0;if($con){foreach($con as $k=>$item){$have=$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('youhuiquan')->field('id,pass')->where('taobao_id="'.$item['taobao_id'].'"')->find();if($have){if($have['pass']==1){continue;}else {$del[]=$have['id'];}}if($item['price_youhui']<=8.8){$item['cid']=1;}elseif($item['price_youhui']<=20){$item['cid']=2;}else {$item['cid']=0;}$datalist[]=array('buss_name'=>$item['buss_name'],'taobao_id'=>$item['taobao_id'],'addtime'=>$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹'](),'end_time'=>$item['end_time'],'price_order'=>$item['price_order'],'price_youhui'=>$item['price_youhui'],'price_youhuiquan'=>$item['price_youhuiquan'],'thumb'=>$item['thumb'],'tmall'=>(($item['tmall']==1)?1:0),'sales'=>$item['sales'],'couponlink'=>$item['couponlink'],'quan_link'=>$item['quan_link'],'goods_link'=>$item['goods_link'],'commission_type'=>$item['commission_type'],'commission_rate'=>$item['commission_rate'],'commission_url'=>$item['commission_url'],'quan_num_shengyu'=>$item['quan_num_shengyu'],'quan_num_zong'=>$item['quan_num_zong'],'quan_num_ling'=>$item['quan_num_ling'],'introduce'=>$item['introduce'],'content'=>$item['content'],'cate_id'=>$item['cate_id'],'change'=>2,'isbig'=>$item['isbig'],'ismust'=>$item['ismust'],'seo_title'=>$item['buss_name'],'seo_keys'=>$item['buss_name'],'seo_desc'=>$item['buss_name'],'cid'=>$item['cid']);}if($del){$delid=$GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ'](",",$del);$resd=$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('youhuiquan')->delete($delid);}if($datalist){$res=$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('youhuiquan')->addAll($datalist);if($res){$this->ajaxReturn(600, 'é‡‡é›†æˆåŠŸ');}else {$this->ajaxReturn(601, 'é‡‡é›†å¤±è´¥');}}else {$this->ajaxReturn(602, 'é‡å¤æäº¤ï¼Œæ²¡æœ‰æ–°æ•°æ®');}}else {$this->ajaxReturn(603, 'æ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®');}}}?>