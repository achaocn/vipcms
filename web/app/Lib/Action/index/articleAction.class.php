<?php global $phpjiami_decrypt;$phpjiami_decrypt['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']=base64_decode('cHJlZ19yZXBsYWNl');$phpjiami_decrypt['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']=base64_decode('c3RyX3JlcGxhY2U=');$phpjiami_decrypt['ı®”ıÁÁ®ÁÁ¥¾ÃÄ®¯¯®Ã”¥®ˆ¥Ö‹¥Ä”À®']=base64_decode('cHJlZ19tYXRjaA==');$phpjiami_decrypt['”‹¥Ö¯Ö‹ıÁ®ÖÀ®¾¾ÄÖˆ®Ä¯”ı¾‹¾ÄÃıÃ']=base64_decode('aW50dmFs');$phpjiami_decrypt['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']=base64_decode('aW1wbG9kZQ==');$phpjiami_decrypt['‹ÃÃ‹Ã®Ã”Ö‹‹¥ˆÁÃÖÖÀÀ”®Á¥ÃÀ®ı¥‹”Ö']=base64_decode('c3RycG9z');$phpjiami_decrypt['ııÖˆı¥‹ˆ”Ã”¾ÃÖ‹ÃÖˆÁ¯À‹¾”À‹ı”']=base64_decode('dXJsZW5jb2Rl'); ?>
<?php
class articleAction extends FrontAction {public function _initialize(){parent::_initialize();$this->cats_mod =D('article_cate');$this->_mod =M('article');;$this->cid =$_SERVER['HTTP_HOST'];$this->_cate_mod =D('items_cate');$this->assign('nav_curr', 'index');$this->article_mod =M('article');$this->cats_list =$this->cats_mod->get_cats();$this->assign('acats', $this->cats_list);}public function index(){$cid =I('cid', '', 'trim');$p =I('p', 1, 'intval');$map['status'] ='1';if ($cid){$map['cate_id'] =$cid;$title =$this->cats_list[$cid]['name'];$this->assign('title',$title);}$page_size =20;$start =$page_size * ($p - 1);$order ='ordid asc ';$order .= ', id DESC';$cat =$this->cats_mod->find($cid);if($this->ismobile()){$article_list =$this->article_mod->where($map)->order($order)->select();foreach ($article_list as $key => $val){$article_list[$key] =$val;$data =$val['info'];$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<script(.*?)</script>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<iframe(.*?)</iframe>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<style(.*?)</style>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<(.*?)>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']('&nbsp;', '', $data);$data =mb_substr($data, 0, 380, 'utf-8');$article_list[$key]['info'] =$data;$img =$val['info'];$GLOBALS['phpjiami_decrypt']['ı®”ıÁÁ®ÁÁ¥¾ÃÄ®¯¯®Ã”¥®ˆ¥Ö‹¥Ä”À®']('<img.*src=["](.*?)["].*?>', $img, $match);}$this->assign('cid', $cid);$this->assign('article_list', $article_list);$this->js_arr =array('/tkjidicms/wap/js/jquery-3.2.1.min.js', );$this->css_arr =array('/tkjidicms/wap/css/help.css', );$this->assign('js_arr',$this->js_arr);$this->assign('css_arr',$this->css_arr);$this->assign('page_title','çƒ­é—¨èµ„è®¯');$help_mod =M('help');$helps =$help_mod->field('id,title,info')->select();$this->_config_seo(array('title' => 'çƒ­é—¨èµ„è®¯', ));}else {$article_list =$this->article_mod->where($map)->order($order)->limit($start . ',' . $page_size)->select();foreach ($article_list as $key => $val){$article_list[$key] =$val;$data =$val['info'];$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<script(.*?)</script>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<iframe(.*?)</iframe>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<style(.*?)</style>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<(.*?)>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']('&nbsp;', '', $data);$data =mb_substr($data, 0, 380, 'utf-8');$article_list[$key]['info'] =$data;$img =$val['info'];$GLOBALS['phpjiami_decrypt']['ı®”ıÁÁ®ÁÁ¥¾ÃÄ®¯¯®Ã”¥®ˆ¥Ö‹¥Ä”À®']('<img.*src=["](.*?)["].*?>', $img, $match);}$this->assign('cid', $cid);$this->assign('article_list', $article_list);$count =$this->article_mod->where($map)->count('id');$pager =$this->_pager($count, $page_size);$this->assign('page', $pager->jshow());$this->assign('nav_curr', 'article');if(empty($cid)){$this->_config_seo(C('ftx_seo_config.article_index'));}else {$this->_config_seo(C('ftx_seo_config.article_cate'), array('title' => $cat['name'], 'cate_name' => $cat['name'], 'seo_title' => $cat['seo_title'], 'seo_keywords' => $cat['seo_keys'], 'seo_description' => $cat['seo_desc'],));}$sort="score desc,id desc";$where_s =array('status' => '1');$shaiorder =M('shaiorder');$item_list=array();$item_list =$shaiorder->where($where_s)->order($sort_order)->limit(10)->select();if($item_list){foreach($item_list as $k=>$item){$count_order=M('score_order')->where('item_id='.$item['id'].' and status in(0,1)')->count('id');$item_list[$k]['order_count']=$GLOBALS['phpjiami_decrypt']['”‹¥Ö¯Ö‹ıÁ®ÖÀ®¾¾ÄÖˆ®Ä¯”ı¾‹¾ÄÃıÃ']($count_order);}}$banner=$this->getbanner(12);$this->assign('banner',$banner);$this->assign('orderlist',$item_list);}$this->display('index');}public function cate(){$cid =I('id', '', 'trim');$helps =$this->cats_mod->where(array('id' => $cid))->find();!$helps && $this->_404();$p =I('p', 1, 'intval');$map['status'] ='1';if ($cid){$map['cate_id'] =$cid;$title =$this->cats_list[$cid]['name'];}$page_size =20;$start =$page_size * ($p - 1);$order ='ordid asc ';$order .= ', id DESC';$cat =$this->cats_mod->find($cid);$article_list =$this->article_mod->where($map)->order($order)->limit($start . ',' . $page_size)->select();foreach ($article_list as $key => $val){$article_list[$key] =$val;$data =$val['info'];$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<script(.*?)</script>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<iframe(.*?)</iframe>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<style(.*?)</style>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<(.*?)>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']('&nbsp;', '', $data);$data =mb_substr($data, 0, 380, 'utf-8');$article_list[$key]['info'] =$data;$img =$val['info'];$GLOBALS['phpjiami_decrypt']['ı®”ıÁÁ®ÁÁ¥¾ÃÄ®¯¯®Ã”¥®ˆ¥Ö‹¥Ä”À®']('<img.*src=["](.*?)["].*?>', $img, $match);}$this->assign('cid', $cid);$this->assign('article_list', $article_list);$count =$this->article_mod->where($map)->count();$pager =$this->_pager($count, $page_size);$this->assign('page', $pager->jshow());$this->assign('nav_curr', 'article');$this->_config_seo(C('ftx_seo_config.article_cate'), array('title' => $cat['name'], 'cate_name' => $cat['name'], 'seo_title' => $cat['seo_title'], 'seo_keywords' => $cat['seo_keys'], 'seo_description' => $cat['seo_desc'],));$this->display('index');}public function read(){$help_mod =M('help');$help =$help_mod->field('id,title,info')->select();$this->assign('helps', $help);$cid =I('cid', '', 'trim');$id =I('id', '', 'intval');$helps =$this->_mod->where(array('id' => $id))->find();!$helps && $this->_404();$sql_preid ='SELECT title,id FROM ' . C('DB_PREFIX'). 'article WHERE id < ' . $id . ' and status = \'1\' ORDER BY id DESC LIMIT 0,1';$result_preid =mysql_query($sql_preid);while ($print_preid =mysql_fetch_array($result_preid)){$preid =$print_preid['id'];}$sql_nid ='SELECT title,id FROM ' . C('DB_PREFIX'). 'article WHERE id > ' . $id . ' and status = \'1\' ORDER BY id asc LIMIT 0,1';$result_nid =mysql_query($sql_nid);while ($print_nid =mysql_fetch_array($result_nid)){$nid =$print_nid['id'];}D('article')->hits($id);if ($cid){$map['cate_id'] =$cid;$article_mod =M('article_cate')->field('id,name')->find($cid);$title =$article_mod['name'];}$article_cate =M('article_cate');$article_cate_list =$article_cate->select();$items_cate =M('article');$this->cate_list =D('items_cate')->field('id,name,pid')->select();$article =$items_cate->field('id,cate_id,title,tags,mpic,info,hits,author,seo_title,seo_keys,seo_desc,add_time,status')->find($id);$articlep =$items_cate->field('id,cate_id,title,tags,mpic,info,hits,author,seo_title,seo_keys,seo_desc,add_time,status')->find($preid);$articlen =$items_cate->field('id,cate_id,title,tags,mpic,info,hits,author,seo_title,seo_keys,seo_desc,add_time,status')->find($nid);if (isset($article['cate_id'])){$this->cate_name =M('article_cate')->where(array('id' => $article['cate_id']))->getField('name');}$article_cate_name =$this->cate_name;$tags =D('article')->get_tags_by_title($article['title']);$arr =$GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ'](',', $tags);foreach ($tags as $view){if ($GLOBALS['phpjiami_decrypt']['‹ÃÃ‹Ã®Ã”Ö‹‹¥ˆÁÃÖÖÀÀ”®Á¥ÃÀ®ı¥‹”Ö']($article['info'], $view)){$k =$view;$article['info'] =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('/' . $view . '/', '<a href=/?m=search&a=index&k=' . $GLOBALS['phpjiami_decrypt']['ııÖˆı¥‹ˆ”Ã”¾ÃÖ‹ÃÖˆÁ¯À‹¾”À‹ı”']($k). ' target=_blank ><b style=color:red>' . $view . '</b></a>', $article['info'], 1);}}$this->assign('tags', $tags);$data =$article['info'];$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<script(.*?)</script>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<iframe(.*?)</iframe>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<style(.*?)</style>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Á¥®ÃˆÖÄÃÖÖ¯ÖÀ®¥ÃÖÃÖÖ¥‹Ö”ÃˆÀ¯ÁÖ”']('@<(.*?)>@is', "", $data);$data =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']('&nbsp;', '', $data);$data =mb_substr($data, 0, 150, 'utf-8');$this->assign('description', $data);$this->_config_seo(C('ftx_seo_config.article'), array('title' => $article['title'].'_'.$article['seo_title'], 'seo_title' => $article['seo_title'], 'seo_keywords' => $article['tags']?$article['tags']."  ".$article['seo_keys']:$article['seo_keys'], 'seo_description' => $data,));$img =$article['info'];$GLOBALS['phpjiami_decrypt']['ı®”ıÁÁ®ÁÁ¥¾ÃÄ®¯¯®Ã”¥®ˆ¥Ö‹¥Ä”À®']('<img.*src=["](.*?)["].*?>', $img, $match);$picurls =$match[1];$this->assign('tags', $tags);$this->assign('picurls', $picurls);$this->assign('cid', $cid);$this->assign('article_cate_name', $article_cate_name);$this->assign('article_cate_list', $article_cate_list);$this->assign('nid', $nid);$this->assign('preid', $preid);$this->assign('lastid', $lastid);$this->assign('hits', $hits);$this->assign('nav_curr', 'article');$this->assign('articlep', $articlep);$this->assign('articlen', $articlen);$this->assign('article', $article);if($this->ismobile()){$this->js_arr =array('/tkjidicms/wap/js/jquery-3.2.1.min.js', );$this->css_arr =array('/tkjidicms/wap/css/helpDetial.css', );$this->assign('js_arr',$this->js_arr);$this->assign('css_arr',$this->css_arr);$this->assign('page_title','çƒ­é—¨èµ„è®¯');}else {$banner=$this->getbanner(12);$this->assign('banner',$banner);}$this->display();}}?>
