<?php global $phpjiami_decrypt;$phpjiami_decrypt['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']=base64_decode('X2luaXRpYWxpemU=');$phpjiami_decrypt['¯¯”‹¯¯¾®¥Ã”®ÄıÁ¥¯”Ãˆ¥Ã‹”®¯¾ˆ®']=base64_decode('aGVhZGVy');$phpjiami_decrypt['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']=base64_decode('TQ==');$phpjiami_decrypt['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']=base64_decode('dHJpbQ==');$phpjiami_decrypt['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']=base64_decode('c3RydG90aW1l');$phpjiami_decrypt['Á®ˆıˆ”¯ÖıÁ”¾Ö¾®ÃÖÖÖ®”ı””ÃÖ']=base64_decode('c3Vic3Ry');$phpjiami_decrypt['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']=base64_decode('ZGF0ZQ==');$phpjiami_decrypt['ÄÀÁ¾ÃˆÃ¥ÃˆÖÖÃÖÁ¯ÃÖÃÀÀÃÖÃˆ®ÖÁÖıÖ']=base64_decode('YXJyYXlfcG9w');$phpjiami_decrypt['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ']=base64_decode('ZXhwbG9kZQ==');$phpjiami_decrypt['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']=base64_decode('c3RyX3JlcGxhY2U=');$phpjiami_decrypt['ÖÖÁÁˆ¯ÄÃÁ¾Ä¯¾‹¥¥ÖÁ¯ÁÃÄÃˆ¯ÄÀÃ']=base64_decode('ZA==');$phpjiami_decrypt['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']=base64_decode('aW1wbG9kZQ=='); ?>
<?php
 class promoAction extends BackendAction {public function _initialize(){parent::$GLOBALS['phpjiami_decrypt']['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']();$this->_mod =D('promo');$this->_cate_mod =D('promo_cate');$GLOBALS['phpjiami_decrypt']['¯¯”‹¯¯¾®¥Ã”®ÄıÁ¥¯”Ãˆ¥Ã‹”®¯¾ˆ®'](base64_decode('Q29udGVudC1UeXBlOnRleHQvaHRtbDsgY2hhcnNldD11dGYtOA=='));if (!$this->checkAuth()){echo 'ç½‘ç«™æœªæˆæƒï¼Œéœ€è¦æˆæƒæ‰å¯æ­£å¸¸ä½¿ç”¨ï¼Œå®˜ç½‘ç”³è¯· <a href="http:\\/\\/www.tkjidi.com" target="_blank">www.tkjidi.com</a>  å’¨è¯¢å®¢æœQQ 800061081';exit();}}public function _before_index(){$big_menu =array('title' => '<div style="position: fixed;bottom:30px;right: 0px;"><a href="http://www.tkjidi.com" target="_blank">@æ·˜å®¢åŸºåœ°ç‰ˆæƒæ‰€æœ‰ </a></div>',);$this->assign('big_menu', $big_menu);$sort =$this->_request('sort', 'trim', 'ordid');$order =$this->_request('order', 'trim', 'DESC');$res =$this->_cate_mod->order($sort . ' ' . $order)->field('id,name')->select();$cate_list =array();foreach ($res as $val){$cate_list[$val['id']] =$val['name'];}$this->assign('cate_list', $cate_list);$p =$this->_get('p', 'intval', 1);$this->assign('p', $p);}protected function _search(){$map =array();($time_start =$this->_request('time_start', 'trim'))&& $map['add_time'][] =array('egt', strtotime($time_start));($time_end =$this->_request('time_end', 'trim'))&& $map['add_time'][] =array('elt', strtotime($time_end)+ (24 * 60 * 60 - 1));($pass =$this->_request('pass', 'trim'))&& $map['pass'] =$pass;($keyword =$this->_request('keyword', 'trim'))&& $map['title'] =array('like', '%' . $keyword . '%');$cate_id =$this->_request('cate_id', 'intval');$selected_ids ='';if ($cate_id){$id_arr =$this->_cate_mod->get_child_ids($cate_id, true);$map['cate_id'] =array('IN', $id_arr);$spid =$this->_cate_mod->where(array('id' => $cate_id))->getField('spid');$selected_ids =$spid ? $spid . $cate_id : $cate_id;}$this->assign('search', array('time_start' => $time_start, 'time_end' => $time_end, 'cate_id' => $cate_id, 'selected_ids' => $selected_ids, 'pass' => $pass, 'keyword' => $keyword,));return $map;}public function clear(){if (IS_POST){if ($_REQUEST['isok'] == '1'){$action =$this->_post('action', 'trim');$where ='1=1';if (base64_decode('Y2xlYXI=') == $action){$db_file =CONF_PATH . 'db.php';$db =require $db_file;$sql ='TRUNCATE TABLE ' . $db['DB_PREFIX'] . 'promo';$mes =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']()->execute($sql);$this->success(L('clear_success'));}$this->_mod->where($where)->delete();$this->success(L('clear_success'));}else {$this->success('ç¡®è®¤æ˜¯å¦è¦åˆ é™¤ï¼Ÿ', U('promo/clear'));}}else {$this->display();}}public function delete_search(){if (isset($_REQUEST['dosubmit'])){if ($_REQUEST['isok'] == '1'){$where ='1=1';$keyword =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['keyword']);$cate_id =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['cate_id']);$time_start =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['time_start']);$time_end =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['time_end']);$spass =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['pass']);if ($keyword != ''){$where .= ' AND title LIKE \'%' . $keyword . '%\'';}if ($cate_id != '' && $cate_id != 0){$where .= ' AND cate_id=' . $cate_id;}if ($time_start != ''){$time_start_int =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($time_start);$where .= ' AND add_time>=\'' . $time_start_int . '\'';}if ($time_end != ''){$time_end_int =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($time_end);$where .= ' AND add_time<=\'' . $time_end_int . '\'';}if ($spass != ''){$where .= ' AND pass=' . $spass;}$isok =$this->_mod->where($where)->select();$ids ="";foreach ($isok as $val){$ids .= $val['id'] . ',';}if ($ids != ""){$ids =$GLOBALS['phpjiami_decrypt']['Á®ˆıˆ”¯ÖıÁ”¾Ö¾®ÃÖÖÖ®”ı””ÃÖ']($ids, 0, -1);}$this->_mod->where($where)->delete();$this->success('åˆ é™¤æˆåŠŸ', U('promo/clear'));}else {$this->success('ç¡®è®¤æ˜¯å¦è¦åˆ é™¤ï¼Ÿ', U('promo/clear'));}}else {$this->display();}}public function _before_edit(){$id =$this->_get('id', 'intval');$article =$this->_mod->field('id,cate_id')->where(array('id' => $id))->find();$spid =$this->_cate_mod->where(array('id' => $article['cate_id']))->getField('spid');if ($spid == 0){$spid =$article['cate_id'];}else {$spid .= $article['cate_id'];}$this->assign('selected_ids', $spid);}public function ajax_upload_img(){$type =$this->_get('type', 'trim', 'img');if (!empty($_FILES[$type]['name'])){$date =$GLOBALS['phpjiami_decrypt']['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']('ym/d/');$result =$this->_upload($_FILES['img'], 'promo/' . $date, array('width' => '280', 'height' => '280'));if ($result['error']){$this->ajaxReturn(0, $result['info']);}else {$info =$date . $result['info'][0]['savename'];$ext =$GLOBALS['phpjiami_decrypt']['ÄÀÁ¾ÃˆÃ¥ÃˆÖÖÃÖÁ¯ÃÖÃÀÀÃÖÃˆ®ÖÁÖıÖ']($GLOBALS['phpjiami_decrypt']['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ']('.', $info));$data['img'] =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']('.' . $ext, '_thumb.' . $ext, $info);$this->ajaxReturn(1, L('operation_success'), $data['img']);}}else {$this->ajaxReturn(0, L('illegal_parameters'));}}public function ajax_gettags(){$title =$this->_get('title', 'trim');$tag_list =$GLOBALS['phpjiami_decrypt']['ÖÖÁÁˆ¯ÄÃÁ¾Ä¯¾‹¥¥ÖÁ¯ÁÃÄÃˆ¯ÄÀÃ']('items')->get_tags_by_title($title);$tags =$GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ'](',', $tag_list);$this->ajaxReturn(1, l('operation_success'), $tags);}}