<?php global $phpjiami_decrypt;$phpjiami_decrypt['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']=base64_decode('X2luaXRpYWxpemU=');$phpjiami_decrypt['¥ıÃÄ¥®ÃÃÀ¯®ıÀ¥Ä‹ÖÖˆ¾®ÁÃˆÄ¾Äˆ‹']=base64_decode('VQ==');$phpjiami_decrypt['ÃÖıÀˆı®‹¥ÖÀÄˆˆ”ÄÃ¥ı‹¥ıÀÖÄ‹ÀÖ¾ÖÁ']=base64_decode('TA==');$phpjiami_decrypt['Áı‹ÃÖÖ¥Ã”¾ÃÀı®ˆÄÖÃ®ÖÄ®ÖÖ‹ˆÃÖÃÃ¾ˆ']=base64_decode('c3ByaW50Zg==');$phpjiami_decrypt['®ˆ¾¯ÖÖ”Ã‹Ö‹‹ÖÖˆ‹¥”ıÖÀÃ‹ÖÖÃÁˆÃÄ¾']=base64_decode('aW5fYXJyYXk=');$phpjiami_decrypt['ÄÀÁ¾ÃˆÃ¥ÃˆÖÖÃÖÁ¯ÃÖÃÀÀÃÖÃˆ®ÖÁÖıÖ']=base64_decode('YXJyYXlfcG9w');$phpjiami_decrypt['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ']=base64_decode('ZXhwbG9kZQ==');$phpjiami_decrypt['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']=base64_decode('c3RyX3JlcGxhY2U='); ?>
<?php
 class article_cateAction extends BackendAction {public function _initialize(){parent::$GLOBALS['phpjiami_decrypt']['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']();$this->_mod =D('article_cate');}public function index(){$sort =$this->_request("sort", 'trim', 'ordid');$_var_0 =$this->_request('order', 'trim', 'ASC');$_var_1 =new Tree();$_var_1->icon =array('â”‚ ', 'â”œâ”€ ', 'â””â”€ ');$_var_1->nbsp ='&nbsp;&nbsp;&nbsp;';$_var_2 =$this->_mod->order($sort . ' ' . $_var_0)->select();$array =array();foreach ($_var_2 as $_var_3){$_var_3['str_status'] ='<img data-tdtype="toggle" data-id="' . $_var_3['id'] . '" data-field="status" data-value="' . $_var_3['status'] . '" src="__STATIC__/images/admin/toggle_' . ($_var_3['status'] == 0 ? 'disabled' : 'enabled'). '.gif" />';$_var_3['str_manage'] ='<a href="javascript:;" class="J_showdialog" data-uri="' . $GLOBALS['phpjiami_decrypt']['¥ıÃÄ¥®ÃÃÀ¯®ıÀ¥Ä‹ÖÖˆ¾®ÁÃˆÄ¾Äˆ‹']('article_cate/add', array('pid' => $_var_3['id'])). '" data-title="' . $GLOBALS['phpjiami_decrypt']['ÃÖıÀˆı®‹¥ÖÀÄˆˆ”ÄÃ¥ı‹¥ıÀÖÄ‹ÀÖ¾ÖÁ']('add_article_cate'). '" data-id="add" data-width="500" data-height="360">' . $GLOBALS['phpjiami_decrypt']['ÃÖıÀˆı®‹¥ÖÀÄˆˆ”ÄÃ¥ı‹¥ıÀÖÄ‹ÀÖ¾ÖÁ']('add_article_subcate'). '</a> |
                                <a href="javascript:;" class="J_showdialog" data-uri="' . $GLOBALS['phpjiami_decrypt']['¥ıÃÄ¥®ÃÃÀ¯®ıÀ¥Ä‹ÖÖˆ¾®ÁÃˆÄ¾Äˆ‹']('article_cate/edit', array('id' => $_var_3['id'])). '" data-title="' . $GLOBALS['phpjiami_decrypt']['ÃÖıÀˆı®‹¥ÖÀÄˆˆ”ÄÃ¥ı‹¥ıÀÖÄ‹ÀÖ¾ÖÁ']('edit'). ' - ' . $_var_3['name'] . '" data-id="edit" data-width="500" data-height="290">' . $GLOBALS['phpjiami_decrypt']['ÃÖıÀˆı®‹¥ÖÀÄˆˆ”ÄÃ¥ı‹¥ıÀÖÄ‹ÀÖ¾ÖÁ']('edit'). '</a> |
                                <a href="javascript:;" data-acttype="ajax" class="J_confirmurl" data-uri="' . $GLOBALS['phpjiami_decrypt']['¥ıÃÄ¥®ÃÃÀ¯®ıÀ¥Ä‹ÖÖˆ¾®ÁÃˆÄ¾Äˆ‹']('article_cate/delete', array('id' => $_var_3['id'])). '" data-msg="' . $GLOBALS['phpjiami_decrypt']['Áı‹ÃÖÖ¥Ã”¾ÃÀı®ˆÄÖÃ®ÖÄ®ÖÖ‹ˆÃÖÃÃ¾ˆ']($GLOBALS['phpjiami_decrypt']['ÃÖıÀˆı®‹¥ÖÀÄˆˆ”ÄÃ¥ı‹¥ıÀÖÄ‹ÀÖ¾ÖÁ']('confirm_delete_one'), $_var_3['name']). '">' . $GLOBALS['phpjiami_decrypt']['ÃÖıÀˆı®‹¥ÖÀÄˆˆ”ÄÃ¥ı‹¥ıÀÖÄ‹ÀÖ¾ÖÁ']('delete'). '</a>';$_var_3['parentid_node'] =($_var_3['pid'])? ' class="child-of-node-' . $_var_3['pid'] . '"' : '';$array[] =$_var_3;}$_var_4 ='<tr id=\'node-$id\' $parentid_node>
                <td align=\'center\'><input type=\'checkbox\' value=\'$id\' class=\'J_checkitem\'></td>
                <td>$spacer<span data-tdtype=\'edit\' data-field=\'name\' data-id=\'$id\' class=\'tdedit\'>$name</span></td>
                <td align=\'center\'>$id</td>
                <td align=\'center\'><span data-tdtype=\'edit\' data-field=\'ordid\' data-id=\'$id\' class=\'tdedit\'>$ordid</span></td>
                <td align=\'center\'>$str_status</td>
                <td align=\'center\'>$str_manage</td>
                </tr>';$_var_1->init($array);$list =$_var_1->get_tree(0, $_var_4);$this->assign('list', $list);$_var_5 =array('title' => $GLOBALS['phpjiami_decrypt']['ÃÖıÀˆı®‹¥ÖÀÄˆˆ”ÄÃ¥ı‹¥ıÀÖÄ‹ÀÖ¾ÖÁ']('add_article_cate'), 'iframe' => $GLOBALS['phpjiami_decrypt']['¥ıÃÄ¥®ÃÃÀ¯®ıÀ¥Ä‹ÖÖˆ¾®ÁÃˆÄ¾Äˆ‹']('article_cate/add'), 'id' => 'add', 'width' => '500', 'height' => '290');$this->assign('big_menu', $_var_5);$this->assign('list_table', true);$this->display();}public function _before_add(){$_var_6 =$this->_get('pid', 'intval', 0);if ($_var_6){$_var_7 =$this->_mod->where(array('id' => $_var_6))->getField('spid');$_var_7 =$_var_7 ? $_var_7 . $_var_6 : $_var_6;$this->assign('spid', $_var_7);}}protected function _before_insert($_var_8 =''){if ($this->_mod->name_exists($_var_8['name'], $_var_8['pid'])){$this->ajaxReturn(0, L('article_cate_already_exists'));}$_var_8['spid'] =$this->_mod->get_spid($_var_8['pid']);return $_var_8;}protected function _before_update($_var_8 =''){if ($this->_mod->name_exists($_var_8['name'], $_var_8['pid'], $_var_8['id'])){$this->ajaxReturn(0, L('article_cate_already_exists'));}$_var_9 =$this->_mod->field('img,pid')->where(array('id' => $_var_8['id']))->find();if ($_var_8['pid'] != $_var_9['pid']){$_var_10 =$this->_mod->get_child_ids($_var_8['id'], true);if ($GLOBALS['phpjiami_decrypt']['®ˆ¾¯ÖÖ”Ã‹Ö‹‹ÖÖˆ‹¥”ıÖÀÃ‹ÖÖÃÁˆÃÄ¾']($_var_8['pid'], $_var_10)){$this->ajaxReturn(0, L('cannot_move_to_child'));}$_var_8['spid'] =$this->_mod->get_spid($_var_8['pid']);}return $_var_8;}public function ajax_upload_img(){if (!empty($_FILES['img']['name'])){$_var_2 =$this->_upload($_FILES['img'], 'article_cate', array('width' => '80', 'height' => '80'));if ($_var_2['error']){$this->ajaxReturn(0, $_var_2['info']);}else {$_var_11 =$GLOBALS['phpjiami_decrypt']['ÄÀÁ¾ÃˆÃ¥ÃˆÖÖÃÖÁ¯ÃÖÃÀÀÃÖÃˆ®ÖÁÖıÖ']($GLOBALS['phpjiami_decrypt']['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ']('.', $_var_2['info'][0]['savename']));$_var_8['img'] =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']('.' . $_var_11, '_thumb.' . $_var_11, $_var_2['info'][0]['savename']);$this->ajaxReturn(1, L('operation_success'), $_var_8['img']);}}else {$this->ajaxReturn(0, L('illegal_parameters'));}}public function ajax_getchilds(){$_var_12 =$this->_get('id', 'intval');$return =$this->_mod->field('id,name')->where(array('pid' => $_var_12))->select();if ($return){$this->ajaxReturn(1, L('operation_success'), $return);}else {$this->ajaxReturn(0, L('operation_failure'));}}}