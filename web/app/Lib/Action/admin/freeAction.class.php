<?php global $phpjiami_decrypt;$phpjiami_decrypt['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']=base64_decode('X2luaXRpYWxpemU=');$phpjiami_decrypt['¯¯”‹¯¯¾®¥Ã”®ÄıÁ¥¯”Ãˆ¥Ã‹”®¯¾ˆ®']=base64_decode('aGVhZGVy');$phpjiami_decrypt['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']=base64_decode('dGltZQ==');$phpjiami_decrypt['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']=base64_decode('c3RydG90aW1l');$phpjiami_decrypt['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']=base64_decode('TQ==');$phpjiami_decrypt['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']=base64_decode('SQ==');$phpjiami_decrypt['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']=base64_decode('RA==');$phpjiami_decrypt['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']=base64_decode('dHJpbQ==');$phpjiami_decrypt['¯®¥Á®ÀÁ®¥¥¥Ä¯‹Ä¾ı¥ÖÄ¯ııÖ‹ÃıÃ¥ıÃ”']=base64_decode('aW1wb3J0');$phpjiami_decrypt['Á®ˆıˆ”¯ÖıÁ”¾Ö¾®ÃÖÖÖ®”ı””ÃÖ']=base64_decode('c3Vic3Ry');$phpjiami_decrypt['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']=base64_decode('aW1wbG9kZQ==');$phpjiami_decrypt['‹”Ä¥ÀÀ¥Á””ıÃÁÃÄ‹¾¥”ÖÁÀ®‹Ä¾ı']=base64_decode('c2V0X3RpbWVfbGltaXQ=');$phpjiami_decrypt['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']=base64_decode('ZmlsZV9nZXRfY29udGVudHM='); ?>
<?php
 class freeAction extends BackendAction {public function _initialize(){parent::$GLOBALS['phpjiami_decrypt']['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']();$this->_mod =D('free');$GLOBALS['phpjiami_decrypt']['¯¯”‹¯¯¾®¥Ã”®ÄıÁ¥¯”Ãˆ¥Ã‹”®¯¾ˆ®'](base64_decode('Q29udGVudC1UeXBlOnRleHQvaHRtbDsgY2hhcnNldD11dGYtOA=='));if (!$this->checkAuth()){echo 'ç½‘ç«™æœªæˆæƒï¼Œéœ€è¦æˆæƒæ‰å¯æ­£å¸¸ä½¿ç”¨ï¼Œå®˜ç½‘ç”³è¯· <a href="http:\\/\\/www.tkjidi.com" target="_blank">www.tkjidi.com</a>  å’¨è¯¢å®¢æœQQ 800061081';exit();}}protected function _search(){$map =array();($time_start =$this->_request('time_start', 'trim'))&& $map['add_time'][] =array('egt', strtotime($time_start));($time_end =$this->_request('time_end', 'trim'))&& $map['add_time'][] =array('elt', strtotime($time_end)+ (24 * 60 * 60 - 1));($price_min =$this->_request('price_min', 'trim'))&& $map['price'][] =array('egt', $price_min);($price_max =$this->_request('price_max', 'trim'))&& $map['price'][] =array('elt', $price_max);($keyword =$this->_request('keyword', 'trim'))&& $map['title'] =array('like', '%' . $keyword . '%');$this->assign('search', array('time_start' => $time_start, 'time_end' => $time_end, 'price_min' => $price_min, 'price_max' => $price_max, 'keyword' => $keyword,));return $map;}public function add(){if (IS_POST){$data =$_POST['info'];$data['deposit'] =$data['price'] * $data['num'];$data['add_time'] =$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']();$data['end_time'] =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($data['end_time']);$data['start_time'] =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($data['start_time']);if ($data['start_time'] > $data['end_time'])$this->error('å¼€å§‹æ—¶é—´ä¸èƒ½æ¯”ç»“æŸæ—¶é—´å¤§');if ($data['remain'] > $data['num'])$this->error('å‰©ä½™ä»½æ•°ä¸èƒ½æ¯”é™é‡ä»½æ•°å¤§');$item_id =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('free')->add($data);!$item_id && $this->error(L('operation_failure'));$this->success(L('operation_success'));}else {$this->display();}}public function edit(){if (IS_POST){$data =$_POST['info'];$data['end_time'] =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($data['end_time']);$data['start_time'] =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($data['start_time']);if ($data['start_time'] > $data['end_time'])$this->error('å¼€å§‹æ—¶é—´ä¸èƒ½æ¯”ç»“æŸæ—¶é—´å¤§');if ($data['remain'] > $data['num'])$this->error('å‰©ä½™ä»½æ•°ä¸èƒ½æ¯”é™é‡ä»½æ•°å¤§');$this->_mod->where(array('id' => $data['id']))->save($data);$this->success(L('operation_success'));}else {$id =$this->_get('id', 'intval');if ($id){$item =$this->_mod->where(array('id' => $id))->find();}$this->assign('info', $item);$this->display('add');}}public function index(){$ischeck =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.ischeck');if ($ischeck == 1){$map['status'] =1;}elseif ($ischeck == 2){$map['status'] =2;}elseif ($ischeck == 3){$map['status'] =3;}$mod =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('free');$this->_list($mod, $map);$this->display();}public function order(){$map =array();($time_start =$this->_request('time_start', 'trim'))&& $map['add_time'][] =array('egt', strtotime($time_start));($time_end =$this->_request('time_end', 'trim'))&& $map['add_time'][] =array('elt', strtotime($time_end)+ (24 * 60 * 60 - 1));($price_min =$this->_request('price_min', 'trim'))&& $map['price'][] =array('egt', $price_min);($price_max =$this->_request('price_max', 'trim'))&& $map['price'][] =array('elt', $price_max);($keyword =$this->_request('keyword', 'trim'))&& $map['title'] =array('like', '%' . $keyword . '%');($order_id =$this->_request('order_id', 'trim'))&& $map['order_id'] =array('like', '%' . $order_id . '%');$this->assign('search', array('time_start' => $time_start, 'time_end' => $time_end, 'price_min' => $price_min, 'price_max' => $price_max, 'keyword' => $keyword, 'order_id' => $order_id,));$mod =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('order');$this->_list($mod, $map);$this->display();}public function complain_delete(){$mod =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('complain');$pk =$mod->getPk();$ids =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($this->_request($pk), ',');if ($ids){if (false !== $mod->delete($ids)){IS_AJAX && $this->ajaxReturn(1, L('operation_success'));$this->success(L('operation_success'));}else {IS_AJAX && $this->ajaxReturn(0, L('operation_failure'));$this->error(L('operation_failure'));}}else {IS_AJAX && $this->ajaxReturn(0, L('illegal_parameters'));$this->error(L('illegal_parameters'));}}public function apply_order_confirm(){$id =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.id');$pass =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.pass');$mod =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('apply_order');$apply_order =$mod->where("id = $id")->find();if ($apply_order['status'] == 'ç”³è¯·ä¸­'){if ($pass == 1){$result =$mod->where("id = $id")->setField('status', 'å·²æç°');}elseif ($pass == 2){$mod->where("id = $id")->setField('status', 'å®¡æ ¸ä¸é€šè¿‡');$result =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('user')->where("id =" . $apply_order['uid'])->setInc('money', $apply_order['money']);$finance['uid'] =$apply_order['uid'];$finance['money'] =$apply_order['money'];$finance['memo'] ='æç°å®¡æ ¸å¤±è´¥è¿”è¿˜æ¬¾é¡¹';$finance['add_time'] =$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']();$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı'](base64_decode('ZmluYW5jZQ=='))->add($finance);}if ($result){IS_AJAX && $this->ajaxReturn(1, 'æ“ä½œæˆåŠŸ');$this->error(L('operation_failure'));}else {IS_AJAX && $this->ajaxReturn(0, L('operation_failure'));$this->error(L('operation_failure'));}}}public function apply_order_delete(){$mod =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('apply_order');$pk =$mod->getPk();$ids =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($this->_request($pk), ',');if ($ids){if (false !== $mod->delete($ids)){IS_AJAX && $this->ajaxReturn(1, L('operation_success'));$this->success(L('operation_success'));}else {IS_AJAX && $this->ajaxReturn(0, L('operation_failure'));$this->error(L('operation_failure'));}}else {IS_AJAX && $this->ajaxReturn(0, L('illegal_parameters'));$this->error(L('illegal_parameters'));}}public function order_delete(){$mod =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('order');$pk =$mod->getPk();$ids =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($this->_request($pk), ',');if ($ids){if (false !== $mod->delete($ids)){IS_AJAX && $this->ajaxReturn(1, L('operation_success'));$this->success(L('operation_success'));}else {IS_AJAX && $this->ajaxReturn(0, L('operation_failure'));$this->error(L('operation_failure'));}}else {IS_AJAX && $this->ajaxReturn(0, L('illegal_parameters'));$this->error(L('illegal_parameters'));}}public function checkOrder(){$order_mod =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('order');$id =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.id');$check =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.check');$order =$order_mod->find($id);if (!$order)IS_AJAX && $this->ajaxReturn(0, 'æ•°æ®æœ‰è¯¯');if ($order['status'] != 'å¾…å®¡æ ¸è®¢å•å·')IS_AJAX && $this->ajaxReturn(0, 'æ•°æ®æœ‰è¯¯');if ($check == 1){$order['status'] ='å·²è¿”è¿˜';$result =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('user')->where("id = " . $order['uid'])->setInc('money', $order['price']);$finance['uid'] =$order['uid'];$finance['money'] =$order['price'];$finance['memo'] =$order['title'] . 'è¿”æ¬¾';$finance['add_time'] =$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']();$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı'](base64_decode('ZmluYW5jZQ=='))->add($finance);$order_mod->save($order);if ($result){IS_AJAX && $this->ajaxReturn(1, 'å®¡æ ¸æˆåŠŸ');}else {IS_AJAX && $this->ajaxReturn(0, 'ä¿å­˜å¤±è´¥');}}else {$order['status'] ='è®¢å•å·æœ‰è¯¯';$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı'](base64_decode('ZnJlZQ=='))->where(base64_decode('aWQgPSA=') . $order['items_id'])->setInc('remain', 1);$result =$order_mod->save($order);if ($result){IS_AJAX && $this->ajaxReturn(1, 'å®¡æ ¸æˆåŠŸ');}else {IS_AJAX && $this->ajaxReturn(0, 'ä¿å­˜å¤±è´¥');}}}public function complain(){$map =array();($time_start =$this->_request('time_start', 'trim'))&& $map['add_time'][] =array('egt', strtotime($time_start));($time_end =$this->_request('time_end', 'trim'))&& $map['add_time'][] =array('elt', strtotime($time_end)+ (24 * 60 * 60 - 1));($order_id =$this->_request('order_id', 'trim'))&& $map['order_id'] =array('like', '%' . $order_id . '%');$this->assign('search', array('time_start' => $time_start, 'time_end' => $time_end, 'order_id' => $order_id,));$mod =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('complain');$this->_list($mod, $map);$this->display();}public function apply_order(){$map =array();($time_start =$this->_request('time_start', 'trim'))&& $map['add_time'][] =array('egt', strtotime($time_start));($time_end =$this->_request('time_end', 'trim'))&& $map['add_time'][] =array('elt', strtotime($time_end)+ (24 * 60 * 60 - 1));($alipay =$this->_request('alipay', 'trim'))&& $map['alipay'] =array('like', '%' . $alipay . '%');($keyword =$this->_request('keyword', 'trim'))&& $map['name'] =array('like', '%' . $keyword . '%');$this->assign('search', array('time_start' => $time_start, 'time_end' => $time_end, 'alipay' => $alipay, 'keyword' => $keyword,));$mod =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('apply_order');$this->_list($mod, $map);$this->display();}public function complain_admin(){if (IS_POST){$data =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('post.info');$fankuan =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('post.fankuan');$oid =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('post.oid');$result =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('complain')->save($data);if ($fankuan){$order =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('order')->where("id =" . $oid)->find();$order['status'] ='å·²è¿”è¿˜';$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾'](base64_decode('b3JkZXI='))->save($order);$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı'](base64_decode('dXNlcg=='))->where(base64_decode('aWQgPQ==') . $order['uid'])->setInc('money', $order['price']);$finance['uid'] =$order['uid'];$finance['money'] =$order['price'];$finance['memo'] =$order['title'] . 'è¿”æ¬¾';$finance['add_time'] =$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']();$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı'](base64_decode('ZmluYW5jZQ=='))->add($finance);}if ($result){$this->success('å›å¤æˆåŠŸ');}else {$this->error('æäº¤å¤±è´¥');}}else {$id =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.id');$this->info =M('complain')->where("id = $id")->find();$this->display();}}public function complain_reply(){if (IS_POST){$data =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('post.info');$GLOBALS['phpjiami_decrypt']['¯®¥Á®ÀÁ®¥¥¥Ä¯‹Ä¾ı¥ÖÄ¯ııÖ‹ÃıÃ¥ıÃ”'](base64_decode('T1JHLk5ldC5VcGxvYWRGaWxl'));$upload =new UploadFile();$upload->maxSize =3145728;$upload->allowExts =array('jpg', 'gif', 'png', 'jpeg');$upload->savePath ='./data/upload/complain/';if ($_FILES['reply_pz']){$info =$upload->uploadOne($_FILES['reply_pz']);$data['reply_pz'] =$info[0]['savepath'] . $info[0]['savename'];if (!$info)$this->error("ä¸Šä¼ å‡ºé”™");}$data['reply_time'] =$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']();$data['status'] ="ç­‰å¾…è£å†³";$result =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('complain')->save($data);if ($result){$this->success('å›å¤æˆåŠŸ' . $fankuan);}else {$this->error('æäº¤å¤±è´¥');}}else {$id =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('get.id');$this->info =M('complain')->where("id = $id")->find();$this->display();}}public function delete_search(){if (isset($_REQUEST['dosubmit'])){if ($_REQUEST['isok'] == "1"){$where ='1=1';$keyword =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['keyword']);$cate_id =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['cate_id']);$cate_id =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['cate_id']);$time_start =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['time_start']);$time_end =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['time_end']);$status =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['status']);$min_price =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['min_price']);$max_price =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($_POST['max_price']);if ($keyword != ''){$where .= " AND title LIKE '%" . $keyword . "%'";}if ($cate_id != '' && $cate_id != 0){$where .= " AND cate_id=" . $cate_id;}if ($time_start != ''){$time_start_int =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($time_start);$where .= " AND coupon_end_time>='" . $time_start_int . "'";}if ($time_end != ''){$time_end_int =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($time_end);$where .= " AND coupon_end_time<='" . $time_end_int . "'";}if ($status != ''){$where .= " AND status=" . $status;}if ($min_price != ''){$where .= " AND coupon_price>=" . $min_price;}if ($max_price != ''){$where .= " AND coupon_price<=" . $max_price;}$ids_list =$this->_mod->where($where)->select();$ids ="";foreach ($ids_list as $val){$ids .= $val['id'] . ",";}if ($ids != ""){$ids =$GLOBALS['phpjiami_decrypt']['Á®ˆıˆ”¯ÖıÁ”¾Ö¾®ÃÖÖÖ®”ı””ÃÖ']($ids, 0, -1);}$this->_mod->where($where)->delete();$this->success('åˆ é™¤æˆåŠŸ', U('items/clear'));}else {$this->success('ç¡®è®¤æ˜¯å¦è¦åˆ é™¤ï¼Ÿ', U('items/clear'));}}else {$this->display();}}public function check(){if ($this->_request("sort", 'trim')){$sort =$this->_request("sort", 'trim');}else {$sort ='id';}if ($this->_request("order", 'trim')){$order =$this->_request("order", 'trim');}else {$order ='DESC';}$res =$this->_cate_mod->field('id,name')->select();$cate_list =array();foreach ($res as $val){$cate_list[$val['id']] =$val['name'];}$this->assign('cate_list', $cate_list);$map =array();$map['pass'] =0;$map['status'] ='underway';($time_start =$this->_request('time_start', 'trim'))&& $map['add_time'][] =array('egt', strtotime($time_start));($time_end =$this->_request('time_end', 'trim'))&& $map['add_time'][] =array('elt', strtotime($time_end)+ (24 * 60 * 60 - 1));$cate_id =$this->_request('cate_id', 'intval');if ($cate_id){$id_arr =$this->_cate_mod->get_child_ids($cate_id, true);$map['cate_id'] =array('IN', $id_arr);$spid =$this->_cate_mod->where(array('id' => $cate_id))->getField('spid');if ($spid == 0){$spid =$cate_id;}else {$spid .= $cate_id;}}($keyword =$this->_request('keyword', 'trim'))&& $map['title'] =array('like', '%' . $keyword . '%');$this->assign('search', array('time_start' => $time_start, 'time_end' => $time_end, 'selected_ids' => $spid, 'cate_id' => $cate_id, 'keyword' => $keyword,));$count =$this->_mod->where($map)->count('id');$pager =new Page($count, 20);$select =$this->_mod->where($map)->order('id DESC');$select->limit($pager->firstRow . ',' . $pager->listRows);$select->order($sort . ' ' . $order);$page =$pager->show();$this->assign("page", $page);$listarr =$select->select();$lists =array();foreach ($listarr as $key => $val){$lists[$key] =$val;}$this->assign('list', $lists);$this->assign('list_table', true);$this->display();}public function fail(){$mod =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('free');$id =$_GET['id'];$datas['id'] =array('eq', $id);$datas['status'] =3;if ($datas){if (false !== $mod->save($datas)){$this->success(L('operation_success'));}else {$this->error(L('operation_failure'));}}else {$this->error(L('illegal_parameters'));}}public function do_check(){$mod =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('free');$id =$_GET['id'];$deposit =$mod->where("id = $id")->getField('deposit');$datas['id'] =array('eq', $id);$datas['status'] =2;$datas['paid'] =$deposit;if ($datas){if (false !== $mod->save($datas)){$this->success(L('operation_success'));}else {$this->error(L('operation_failure'));}}else {$this->error(L('illegal_parameters'));}}public function ajaxgetid(){$url =$this->_get('url', 'trim');$url == '' && $this->ajaxReturn(0, L('please_input'). L('correct_itemurl'));!$this->get_id($url)&& $this->ajaxReturn(0, L('please_input'). L('correct_itemurl'));$iid =$this->get_id($url);$items =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('items')->where(array('num_iid' => $iid))->find();$items && $this->ajaxReturn(0, L('item_exist'));$content =$this->getItem($iid);$this->ajaxReturn(1, '', $content);}public function ajax_gettags(){$title =$this->_get('title', 'trim');$tag_list =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('items')->get_tags_by_title($title);$tags =$GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ'](' ', $tag_list);$this->ajaxReturn(1, L('operation_success'), $tags);}public function ajax_time(){$this->ajaxReturn(1, L('operation_success'), time());}public function ajax_getclick_url(){$iid =$this->_get('iid', 'trim');$url ='http://item.taobao.com/item.htm?id=' . $iid;$itemcollect =new itemcollect();$itemcollect->url_parse($url);$item =$itemcollect->fetch_tb();if ($item =$itemcollect->fetch_tb()){$this->ajaxReturn(1, L('operation_success'), $item['click_url']);}$this->ajaxReturn(0, L('operation_failure'));}public function http($url){$GLOBALS['phpjiami_decrypt']['‹”Ä¥ÀÀ¥Á””ıÃÁÃÄ‹¾¥”ÖÁÀ®‹Ä¾ı'](0);$result =$GLOBALS['phpjiami_decrypt']['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']($url);if ($result === false){$curl =curl_init();curl_setopt($curl, CURLOPT_URL, $url);curl_setopt($curl, CURLOPT_HEADER, false);curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);$result =curl_exec($curl);curl_close($curl);}if (empty($result)){$result =false;}return $result;}public function ajax_upload(){if (!empty($_FILES['img']['name'])){$result =$this->_upload($_FILES['img'], "item/");if ($result['error']){$this->error($result['info']);}else {$data['img'] =$result['info'][0]['savename'];$this->ajaxReturn(1, L("operation_success"), C("ftx_attach_path"). "item/" . $data['img']);}}else {$this->ajaxReturn(0, L("illegal_parameters"));}}}