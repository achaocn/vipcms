<?php global $phpjiami_decrypt;$phpjiami_decrypt['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']=base64_decode('X2luaXRpYWxpemU=');$phpjiami_decrypt['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']=base64_decode('Rg==');$phpjiami_decrypt['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']=base64_decode('dHJpbQ==');$phpjiami_decrypt['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']=base64_decode('c3RydG90aW1l');$phpjiami_decrypt['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']=base64_decode('TQ==');$phpjiami_decrypt['¥®ı¯ÀÀˆ¯¾Ö”Ö‹ÖÁˆıÄ¾Ö‹ÃıÃˆ®¥ıı‹‹']=base64_decode('ZnVuY3Rpb25fZXhpc3Rz');$phpjiami_decrypt['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']=base64_decode('SQ==');$phpjiami_decrypt['Ö¾ıÁˆÄÁÖı®Ã¯Öı¯ı¥¾Ã‹ÃÁÄ®¥ÄÄÄ‹Ã‹']=base64_decode('c3RyaXBfdGFncw==');$phpjiami_decrypt['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']=base64_decode('RA==');$phpjiami_decrypt['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']=base64_decode('dGltZQ==');$phpjiami_decrypt['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']=base64_decode('ZmlsZV9nZXRfY29udGVudHM=');$phpjiami_decrypt['®¥ÃÄı®¾Ã®ÖÖÄÃ¥ÃÃˆıı¾ÄÁ¾ÃÀ‹']=base64_decode('cmFuZA==');$phpjiami_decrypt['¯‹‹Ã¯¯®Ã¯ÃÀÁÃ”Ã‹®”Ã¥À¥ˆÃÁÖÄ‹ÖÖ']=base64_decode('cm91bmQ=');$phpjiami_decrypt['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']=base64_decode('aW1wbG9kZQ==');$phpjiami_decrypt['ˆı¾ÖÁÀÖ”Ãˆ‹ıÄ®ˆ‹ˆ¯¯ÀÁ¯®Ã¯‹Ö”®ÖˆÀ']=base64_decode('bGVmdHRpbWU='); ?>
<?php
 ?>
<?php
 class uzrobotsAction extends BackendAction {public function _initialize(){parent::$GLOBALS['phpjiami_decrypt']['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']();$this->_mod =D('uzrobots');$this->_cate_mod =D('items_cate');}public function _before_index(){$big_menu =array('title' => '<div style="position: fixed;bottom:30px;right: 0px;"></div>',);$this->assign('big_menu', $big_menu);$res =$this->_cate_mod->field('id,name')->select();$cate_list =array();foreach ($res as $val){$cate_list[$val['id']] =$val['name'];}$this->assign('cate_list', $cate_list);$uzuzrobots_collect_data =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('uzuzrobots_collect_data');$this->assign('uzrobots_collect_data', $uzrobots_collect_data);$this->sort ='ordid ASC,';$this->order ='last_time DESC';}public function add(){if (IS_POST){$name =$this->_post('name', 'trim');$keyword =$this->_post('keyword', 'trim');$start_time =$this->_post('start_time', 'trim');$end_time =$this->_post('end_time', 'trim');$cate_id =$this->_post('cate_id', 'trim');$hm_cid =$this->_post('hm_cid', 'trim');$lastvolume =$this->_post('lastvolume', 'trim');if (!$name || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($name)){$this->error('è¯·ç»™é‡‡é›†å™¨å–ä¸ªåå­—ï¼Œä»¥ä¾¿åŒºåˆ†');}if (!$cate_id || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($cate_id)){$this->error('è¯·é€‰æ‹©å…¥åº“åˆ†ç±»');}if (!$hm_cid || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($hm_cid)){$this->error('è¯·é€‰æ‹©åˆ†ç±»');}$data['name'] =$name;$data['lastvolume'] =$lastvolume;$data['keyword'] =$keyword;$data['start_time'] =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($start_time);$data['end_time'] =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($end_time);$data['cate_id'] =$cate_id;$data['hm_cid'] =$hm_cid;$this->_mod->create($data);$item_id =$this->_mod->add();$this->success('æ·»åŠ æˆåŠŸï¼');}}public function edit(){if (IS_POST){$id =$this->_post('id', 'trim');$name =$this->_post('name', 'trim');$keyword =$this->_post('keyword', 'trim');$start_time =$this->_post('start_time', 'trim');$end_time =$this->_post('end_time', 'trim');$cate_id =$this->_post('cate_id', 'trim');$hm_cid =$this->_post('hm_cid', 'trim');$lastvolume =$this->_post('lastvolume', 'trim');if (!$name || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($name)){$this->error('è¯·ç»™é‡‡é›†å™¨å–ä¸ªåå­—ï¼Œä»¥ä¾¿åŒºåˆ†');}if (!$cate_id || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($cate_id)){$this->error('è¯·é€‰æ‹©å•†å“åˆ†ç±»');}if (!$hm_cid || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($hm_cid)){$this->error('è¯·é€‰æ‹©åˆ†ç±»');}$data['name'] =$name;$data['lastvolume'] =$lastvolume;$data['keyword'] =$keyword;$data['start_time'] =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($start_time);$data['end_time'] =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($end_time);$data['cate_id'] =$cate_id;$data['hm_cid'] =$hm_cid;$this->_mod->where(array('id' => $id))->save($data);$this->success(L('operation_success'));}else {$id =$this->_get('id', 'intval');$item =$this->_mod->where(array('id' => $id))->find();$spid =$this->_cate_mod->where(array('id' => $item['cate_id']))->getField('spid');if ($spid == 0){$spid =$item['cate_id'];}else {$spid .= $item['cate_id'];}$this->assign('selected_ids', $spid);$this->assign('info', $item);$orig_list =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('items_orig')->select();$this->assign('orig_list', $orig_list);if (!$GLOBALS['phpjiami_decrypt']['¥®ı¯ÀÀˆ¯¾Ö”Ö‹ÖÁˆıÄ¾Ö‹ÃıÃˆ®¥ıı‹‹'](base64_decode('Y3VybF9nZXRpbmZv'))){$this->error(L('curl_not_open'));}$this->display();}}public function add_do(){if (!$GLOBALS['phpjiami_decrypt']['¥®ı¯ÀÀˆ¯¾Ö”Ö‹ÖÁˆıÄ¾Ö‹ÃıÃˆ®¥ıı‹‹']("curl_getinfo")){$this->error(L('curl_not_open'));}$this->display();}public function collect(){$id =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('id', '', 'intval');$auto =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('auto', 0, 'intval');$p =$this->_get('p', 'intval', 1);$date =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('uzrobots')->where(array('id' => $id))->find();$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('cm9ib3Rfc2V0dGluZw=='), $date);if ($date){if ($p > 20){$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('totalcoll', NULL);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('dXpyb2JvdHNfdGltZQ=='), NULL);$this->ajaxReturn(0, 'å·²ç»é‡‡é›†å®Œæˆ20é¡µï¼è¯·è¿”å›ï¼Œè°¢è°¢');}$result_data =$this->taobao_collect($date, $p);$this->assign('result_data', $result_data);if ($result_data['coll'] == 0){$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('totalcoll', NULL);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('dXpyb2JvdHNfdGltZQ=='), NULL);$this->ajaxReturn(0, 'å·²ç»é‡‡é›†å®Œæˆ' . $p . 'é¡µï¼è¯·è¿”å›ï¼Œè°¢è°¢');}$resp =$this->fetch('collect');$this->ajaxReturn(1, '', $resp);}else {$this->ajaxReturn(0, 'error');}}private function _ajax_tb_publish_insert($item){$item['title'] =$GLOBALS['phpjiami_decrypt']['Ö¾ıÁˆÄÁÖı®Ã¯Öı¯ı¥¾Ã‹ÃÁÄ®¥ÄÄÄ‹Ã‹']($item['title']);$result =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('items')->ajax_tb_publish($item);return $result;}public function taobao_collect($date, $p){$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('uzrobots')->where(array('id' => $date['id']))->save(array('last_time' => time()));if (false === $totalcoll =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('totalcoll')){$totalcoll =0;}if (false === $uzrobots_time =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('uzrobots_time')){$uzrobots_time =$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']();$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('dXpyb2JvdHNfdGltZQ=='), $GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']());}if ($p % 2 == 0){$ppage =0;$pageNav ='true';}else {$ppage =($p + 1)/ 2;$pageNav ='false';}if ($date['ems'] == 1){$postFree ='true';}else {$postFree ='false';}if ($p == 1){$totalcoll =0;}else {$totalcoll =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('totalcoll');}$url ="http://open.nedor.cn/index.php?m=api&a=collect&keyword=" . $date['keyword'] . "&hm_cid=" . $date['hm_cid'] . "&lastvolume=" . $date['lastvolume'] . "&p=" . $p;$source =$GLOBALS['phpjiami_decrypt']['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']($url);$result_data =json_decode($source, true);$info['totalnum'] =$result_data['count'];$totalnum =$info['totalnum'];$info =array();if ($source){for ($i =0;$i < 40;$i++){$itemarray['shop_type'] =$result_data['item'][$i]['shop_type'];$itemarray['price'] =$result_data['item'][$i]['price'];$itemarray['volume'] =$result_data['item'][$i]['volume'];$itemarray['sellerId'] =$result_data['item'][$i]['sellerId'];$itemarray['intro'] =$result_data['item'][$i]['intro'];$itemarray['title'] =$result_data['item'][$i]['title'];$itemarray['num_iid'] =$result_data['item'][$i]['num_iid'];$itemarray['pic_url'] =$result_data['item'][$i]['pic_url'];$itemarray['cu'] =$result_data['item'][$i]['cu'];$itemarray['coupon_price'] =$result_data['item'][$i]['coupon_price'];$itemarray['nick'] =$result_data['item'][$i]['nick'];$itemarray['cate_id'] =$date['cate_id'];$itemarray['ems'] =$result_data['item'][$i]['ems'];$itemarray['commission_rate'] =$result_data['item'][$i]['commission_rate'];$itemarray['commission'] =$result_data['item'][$i]['commission'];$likes =$GLOBALS['phpjiami_decrypt']['®¥ÃÄı®¾Ã®ÖÖÄÃ¥ÃÃˆıı¾ÄÁ¾ÃÀ‹'](99, 9999);$zkou =$GLOBALS['phpjiami_decrypt']['¯‹‹Ã¯¯®Ã¯ÃÀÁÃ”Ã‹®”Ã¥À¥ˆÃÁÖÄ‹ÖÖ'](($itemarray['coupon_price'] / $itemarray['price'])* 10, 1);$coupon_rate =$zkou * 1000;$tag_list =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']("items")->get_tags_by_title($itemarray['title']);$tags =$GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ'](" ", $tag_list);$itemarray['coupon_start_time'] =$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']();$itemarray['coupon_end_time'] =$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()+ 720000;$itemarray['tags'] =$tags;$itemarray['click_url'] ="";$itemarray['likes'] =$likes;$itemarray['coupon_rate'] =$coupon_rate;if ($itemarray['title'] && $itemarray['pic_url'] && $itemarray['num_iid']){$result['item_list'][] =$itemarray;}}}else {$result['msg'] ='é‡‡é›†ç»“æŸï¼è¯·è¿”å›!';}$taobaoke_item_list =$result['item_list'];$taobaoke_item_list && $GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('taobaoke_item_list', $taobaoke_item_list);$coll =0;$thiscount =0;foreach ($taobaoke_item_list as $key => $val){$res =$this->_ajax_tb_publish_insert($val);if ($res > 0){$coll++;$totalcoll++;}$thiscount++;}$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('dG90YWxjb2xs'), $totalcoll);$result_data['p'] =$p;$result_data['msg'] =$msg;$result_data['coll'] =$coll;$result_data['totalcoll'] =$totalcoll;$result_data['totalnum'] =$totalnum;$result_data['thiscount'] =$thiscount;$result_data['times'] =$GLOBALS['phpjiami_decrypt']['ˆı¾ÖÁÀÖ”Ãˆ‹ıÄ®ˆ‹ˆ¯¯ÀÁ¯®Ã¯‹Ö”®ÖˆÀ']($GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()- $uzrobots_time);return $result_data;}}unset($zym_5);