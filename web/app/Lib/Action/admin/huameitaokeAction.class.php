<?php global $phpjiami_decrypt;$phpjiami_decrypt['Áý®ÃÄ®Ã‹À¾ÄÁÄý‹ÃŽÖÁýÃÁÖ®¾ÃÃ®‹¯Ã¥']=base64_decode('dmVuZG9y');$phpjiami_decrypt['Ž¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥Ž”ÃÃý®¥®ÄÄ¯Ã¯¥Öˆ']=base64_decode('X2luaXRpYWxpemU=');$phpjiami_decrypt['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']=base64_decode('TQ==');$phpjiami_decrypt['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯Žˆýý”Ã®Á”¯‹Ä¥ÁÃÁ”']=base64_decode('SQ==');$phpjiami_decrypt['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ']=base64_decode('Rg==');$phpjiami_decrypt['”Ã®¾ÃýÖ‹®®¥ÁÖ¥Ž¾”‹¯ýÁˆÁ‹ÁÖÁÖýÃ¥Ã']=base64_decode('b2JqdG9hcnI='); ?>
<?php
 $GLOBALS['phpjiami_decrypt']['Áý®ÃÄ®Ã‹À¾ÄÁÄý‹ÃŽÖÁýÃÁÖ®¾ÃÃ®‹¯Ã¥'](base64_decode('VGFvYmFvdG9wLlRvcENsaWVudA=='));$GLOBALS['phpjiami_decrypt']['Áý®ÃÄ®Ã‹À¾ÄÁÄý‹ÃŽÖÁýÃÁÖ®¾ÃÃ®‹¯Ã¥'](base64_decode('VGFvYmFvdG9wLlJlcXVlc3RDaGVja1V0aWw='));$GLOBALS['phpjiami_decrypt']['Áý®ÃÄ®Ã‹À¾ÄÁÄý‹ÃŽÖÁýÃÁÖ®¾ÃÃ®‹¯Ã¥'](base64_decode('VGFvYmFvdG9wLlJlc3VsdFNldA=='));$GLOBALS['phpjiami_decrypt']['Áý®ÃÄ®Ã‹À¾ÄÁÄý‹ÃŽÖÁýÃÁÖ®¾ÃÃ®‹¯Ã¥'](base64_decode('VGFvYmFvdG9wLnJlcXVlc3QuVGJrSXRlbUluZm9HZXRSZXF1ZXN0'));class huameitaokeAction extends BackendAction {public function _initialize(){parent::$GLOBALS['phpjiami_decrypt']['Ž¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥Ž”ÃÃý®¥®ÄÄ¯Ã¯¥Öˆ']();$this->_mod =D('robots');$this->_cate_mod =D('youhuiquan_cate');$items_site =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']('items_site')->where(array('code' => 'taobao'))->getField('config');$this->_tbconfig =unserialize($items_site);$big_menu =array('title' => '<div style="position: fixed;bottom:30px;right: 0px;"></div>',);$this->assign('big_menu', $big_menu);}public function index(){$res =$this->_cate_mod->field('id,class_name')->select();$cate_list =array();foreach ($res as $val){$cate_list[$val['id']] =$val['class_name'];}$this->assign('cate_list', $cate_list);$map =array();$map['pass'] =0;$map['status'] =0;$count =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']('items')->where($map)->count('id');$pager =new Page($count, 20);$select =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']('items')->where($map)->order('id DESC');$select->limit($pager->firstRow . ',' . $pager->listRows);$page =$pager->show();$this->assign('page', $page);$listarr =$select->select();$lists =array();foreach ($listarr as $key => $val){$lists[$key] =$val;}$this->assign('list', $lists);$this->display();}public function setting(){if (IS_POST){$cate_id =$this->_post('cate_id', 'trim');$fid =$this->_post('fid', 'trim');$eid =$this->_post('eid', 'trim');$step =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯Žˆýý”Ã®Á”¯‹Ä¥ÁÃÁ”']('step', '1', 'intval');$GLOBALS['phpjiami_decrypt']['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ'](base64_decode('Y2t0YXRhX3NldHRpbmc='), array(base64_decode('Y2F0ZV9pZA==') => $cate_id, 'step' => $step, 'fid' => $fid, 'eid' => $eid,));$this->item_checks();}}public function item_checks(){$this->item_mod =M('items');if (false === $setting =$GLOBALS['phpjiami_decrypt']['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ']('cktata_setting')){$this->ajaxReturn(0, L('illegal_parameters'));}$p =$this->_get('p', 'intval', 1);$fid =$setting['fid'];$eid =$setting['eid'];$step =$setting['step'];if ($fid && $eid){$where['id'] =array(array('egt', $fid), array('elt', $eid));}$where['shop_type'] =array('neq', 'M');$cid =$setting['cate_id'];if ($cid){$where['cate_id'] =$cid;}if (false === $item =$GLOBALS['phpjiami_decrypt']['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ']('itemcheck')){$item['this_good'] =0;$item['this_bad'] =0;$item['that_good'] =0;$item['that_bad'] =0;$item['total'] =0;$item['not_total'] =0;$GLOBALS['phpjiami_decrypt']['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ'](base64_decode('aXRlbWNoZWNr'), $item);}if (false === $bad_item =$GLOBALS['phpjiami_decrypt']['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ']('bad_item')){$bad_item =array();$GLOBALS['phpjiami_decrypt']['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ'](base64_decode('YmFkX2l0ZW0='), $bad_item);}$item['this_good'] =0;$item['this_bad'] =0;$where['pass'] ='1';$page_size =$step;$startp =($p - 1)* $page_size;$startp =$startp - $item['that_bad'];$CheckItemCount =$this->item_mod->where($where)->count('id');$item['not_total'] =$CheckItemCount;$order ='id asc ';$items_list =$this->item_mod->field('num_iid,shop_type,coupon_price,price')->where($where)->order($order)->limit($startp, $page_size)->select();if ($items_list){}else {$GLOBALS['phpjiami_decrypt']['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ']('itemcheck', false);$this->ajaxReturn(0, 'æ£€æµ‹å®Œæˆï¼Œè¯·åˆ·æ–°æœ¬é¡µé¢æŸ¥çœ‹æœªå‚ä¸ŽæŽ¨å¹¿çš„å•†å“åˆ—è¡¨ï¼Œè°¢è°¢ï¼');}if ($step){foreach ($items_list as $k => $v){$TopClient =new TopClient;$TopClient->appkey =$this->_tbconfig['app_key'];$TopClient->secretKey =$this->_tbconfig['app_secret'];$TbkItemInfoGetRequest =new TbkItemInfoGetRequest;$TbkItemInfoGetRequest->setFields('reserve_price,zk_final_price');$TbkItemInfoGetRequest->setPlatform(1);$TbkItemInfoGetRequest->setNumIids($v['num_iid']);$ajax_check =$TopClient->execute($TbkItemInfoGetRequest);$data =$GLOBALS['phpjiami_decrypt']['”Ã®¾ÃýÖ‹®®¥ÁÖ¥Ž¾”‹¯ýÁˆÁ‹ÁÖÁÖýÃ¥Ã']($ajax_check);$length =$data['results'];if (!$length){$check ='unsale';}else {$check ='sale';}if ($check == 'sale'){$item['this_good'] =$item['this_good'] + 1;$item['that_good'] =$item['that_good'] + 1;$itemcheckdata['price'] =$data['results']['n_tbk_item'][0]['reserve_price'];$itemcheckdata['coupon_price'] =$data['results']['n_tbk_item'][0]['zk_final_price'];$this->item_mod->where($v)->save($itemcheckdata);$this->item_mod->where($v)->save(array('tk' => 1, 'pass' => 1, 'status' => 'underway'));}elseif ($check == 'unsale'){$bad_item =$GLOBALS['phpjiami_decrypt']['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ']('bad_item');$bad_item[] =$v['num_iid'];$GLOBALS['phpjiami_decrypt']['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ'](base64_decode('YmFkX2l0ZW0='), $bad_item);$item['this_bad'] =$item['this_bad'] + 1;$item['that_bad'] =$item['that_bad'] + 1;$this->item_mod->where($v)->save(array('tk' => 0, 'pass' => 0, 'status' => 'sellout'));}$item['total'] =$item['total'] + 1;}}$GLOBALS['phpjiami_decrypt']['ÖŽŽÃÄÖ¯¥®ŽÖ¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”Ž¯¥ÁÄŽÄÖ'](base64_decode('aXRlbWNoZWNr'), $item);$msg['title'] ='ä½£é‡‘æ£€æµ‹';$msg['p'] =$p + 1;$msg['step'] =$step;$this->assign('item', $item);$this->assign('jobn', $jobn);$ajax_check =$this->fetch('ajax_check');$this->ajaxReturn(1, $msg, $ajax_check);}}