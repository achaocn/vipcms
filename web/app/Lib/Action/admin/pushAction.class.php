<?php global $phpjiami_decrypt;$phpjiami_decrypt['¯¯”‹¯¯¾®¥Ã”®ÄıÁ¥¯”Ãˆ¥Ã‹”®¯¾ˆ®']=base64_decode('aGVhZGVy');$phpjiami_decrypt['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']=base64_decode('c3RyX3JlcGxhY2U=');$phpjiami_decrypt['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ']=base64_decode('ZXhwbG9kZQ==');$phpjiami_decrypt['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']=base64_decode('aW1wbG9kZQ==');$phpjiami_decrypt['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']=base64_decode('dGltZQ==');$phpjiami_decrypt['ıÀÃıÖıÖÃ‹¥Ö¥¯Á®®¾ÖÖı‹®ˆÖÖ¯Öˆ”ÖÁ']=base64_decode('c29ydA==');$phpjiami_decrypt['Á¥ÀÖ¯ÄÁ¥¥ÖÃ‹¥®ÁÄÖˆÄÃ¾®Á¥À‹ÖÀ‹']=base64_decode('c2hhMQ==');$phpjiami_decrypt['‹ÃÃ‹Ã®Ã”Ö‹‹¥ˆÁÃÖÖÀÀ”®Á¥ÃÀ®ı¥‹”Ö']=base64_decode('c3RycG9z');$phpjiami_decrypt['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']=base64_decode('ZmlsZV9nZXRfY29udGVudHM='); ?>
<?php
class pushAction extends BackendAction {public function _initialize(){parent::_initialize();$GLOBALS['phpjiami_decrypt']['¯¯”‹¯¯¾®¥Ã”®ÄıÁ¥¯”Ãˆ¥Ã‹”®¯¾ˆ®']('Content-Type:text/html; charset=utf-8');if (!$this->checkAuth()){echo 'ç½‘ç«™æœªæˆæƒï¼Œéœ€è¦æˆæƒæ‰å¯æ­£å¸¸ä½¿ç”¨ï¼Œå®˜ç½‘ç”³è¯· <a href="http:\\/\\/www.tkjidi.com" target="_blank">www.tkjidi.com</a>  å’¨è¯¢å®¢æœQQ 800061081';exit();}$apiurl='http://newapi.tkjidi.com/';$imgdri='http://cmspic.judacdn.com/tkjidi/upload/images/';$this->assign('apiurl',$apiurl);$this->assign('imgdri',$imgdri);}protected function _idtohash($id){$hashids =new Hashids('tkjidicms',10);$idstr =$hashids->encode($id);return $idstr;}public function index(){$this->display();}public function set_sitemap(){$open =I('open');C('pushbd', $open);}public function pushbd(){$data=get_contents($this->apiurl.'api/vipprolist?per=50&p=1');$datalist=json_decode($data,true);$result=$datalist['data'];$sitetoken =C('ftx_site_token');$ftx_site_url =C('ftx_site_url');$s_site_url =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']("/", '', $ftx_site_url);$site_url =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']("http:", 'http://', $s_site_url);$s_url =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']("http://", '', $site_url);$null_url =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']("/", '', $s_url);foreach ($result as $k => $v){$this->_idtohash($item['id']);$str .= $site_url . '/index.php?m=pro&a=show&id='.$this->_idtohash($v['id']).',';}$urls =$GLOBALS['phpjiami_decrypt']['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀ‹ÀÃ”¾Ã®Ö””ˆÖÄ'](",", $str);$api ='http://data.zz.baidu.com/urls?site=' . $null_url . '&token=' . $sitetoken;$ch =curl_init();$options =array(CURLOPT_URL => $api, CURLOPT_POST => true, CURLOPT_RETURNTRANSFER => true, CURLOPT_POSTFIELDS => $GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']("\n", $urls), CURLOPT_HTTPHEADER => array('Content-Type: text/plain'),);curl_setopt_array($ch, $options);$results =curl_exec($ch);$msg =json_decode($results, true);$error =$msg['error'];$message =$msg['message'];$remain =$msg['remain'];$success =$msg['success'];$not_same_site =$msg['not_same_site'];$not_valid =$msg['not_valid'];if ($error){if ($message == "site error"){$ermsg ='æœ¬ç«™ç‚¹æœªåœ¨ç™¾åº¦ç«™é•¿å¹³å°éªŒè¯ã€‚';}if ($message == "empty content"){$ermsg ='æœ¬æ¬¡æ¨é€é“¾æ¥æ•°æ®ä¸ºç©ºã€‚';}if ($message == "only 2000 urls are allowed once"){$ermsg ='æ¯æ¬¡æœ€å¤šåªèƒ½æäº¤2000æ¡é“¾æ¥ã€‚';}if ($message == "over quota"){$ermsg ='è¶…è¿‡æ¯æ—¥é…é¢äº†ï¼Œè¶…é…é¢åå†æäº¤éƒ½æ˜¯æ— æ•ˆçš„ã€‚';}if ($message == "token is not valid"){$ermsg ='tokené”™è¯¯ã€‚';}if ($message == "not found"){$ermsg ='æ¥å£åœ°å€å¡«å†™é”™è¯¯ã€‚';}if ($message == "internal error, please try later"){$ermsg ='æœåŠ¡å™¨å¶ç„¶å¼‚å¸¸ï¼Œé€šå¸¸é‡è¯•å°±ä¼šæˆåŠŸã€‚';}$msg ='æ¨é€å¤±è´¥ï¼è¿”å›çš„é”™è¯¯ç ï¼š' . $error . 'ï¼Œé”™è¯¯ä¿¡æ¯æç¤ºï¼š' . $ermsg . 'ï¼Œè¯·å‚è€ƒä¸‹æ–¹é”™è¯¯ä»£ç ç¤ºä¾‹';}else {$msg ='æˆåŠŸæ¨é€' . $success . 'æ¡,ä»Šæ—¥è¿˜å¯æ¨é€' . $remain . 'æ¡ã€‚';}$rtn =array('state' => 1, 'msg' => $msg);echo json_encode($rtn);}}function get_contents($url){if(empty($url)){return "";}else {$timestamp=''.$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']().'';$nonce=GetRandStr(4);$client ='vipcms';$key ='tkjidi';$tmpArr =array($client,$key,$timestamp,$nonce);$GLOBALS['phpjiami_decrypt']['ıÀÃıÖıÖÃ‹¥Ö¥¯Á®®¾ÖÖı‹®ˆÖÖ¯Öˆ”ÖÁ']($tmpArr);$string =$GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']($tmpArr);$signature =$GLOBALS['phpjiami_decrypt']['Á¥ÀÖ¯ÄÁ¥¥ÖÃ‹¥®ÁÄÖˆÄÃ¾®Á¥À‹ÖÀ‹']($string);if($GLOBALS['phpjiami_decrypt']['‹ÃÃ‹Ã®Ã”Ö‹‹¥ˆÁÃÖÖÀÀ”®Á¥ÃÀ®ı¥‹”Ö']($url,"?")!==false){$url.='&sign='.$signature.'&timestamp='.$timestamp.'&nonce='.$nonce;}else {$url.='?sign='.$signature.'&timestamp='.$timestamp.'&nonce='.$nonce;}return $GLOBALS['phpjiami_decrypt']['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']($url);}}