<?php global $phpjiami_decrypt;$phpjiami_decrypt['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']=base64_decode('X2luaXRpYWxpemU=');$phpjiami_decrypt['¯¯”‹¯¯¾®¥Ã”®ÄıÁ¥¯”Ãˆ¥Ã‹”®¯¾ˆ®']=base64_decode('aGVhZGVy');$phpjiami_decrypt['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']=base64_decode('c3RydG90aW1l');$phpjiami_decrypt['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']=base64_decode('Rg==');$phpjiami_decrypt['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']=base64_decode('ZmlsZV9nZXRfY29udGVudHM=');$phpjiami_decrypt['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']=base64_decode('c3RyX3JlcGxhY2U=');$phpjiami_decrypt['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']=base64_decode('dHJpbQ==');$phpjiami_decrypt['Ö¾ıÁˆÄÁÖı®Ã¯Öı¯ı¥¾Ã‹ÃÁÄ®¥ÄÄÄ‹Ã‹']=base64_decode('c3RyaXBfdGFncw==');$phpjiami_decrypt['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']=base64_decode('RA=='); ?>
<?php
 class hpzAction extends BackendAction {public function _initialize(){parent::$GLOBALS['phpjiami_decrypt']['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']();$GLOBALS['phpjiami_decrypt']['¯¯”‹¯¯¾®¥Ã”®ÄıÁ¥¯”Ãˆ¥Ã‹”®¯¾ˆ®'](base64_decode('Q29udGVudC1UeXBlOnRleHQvaHRtbDsgY2hhcnNldD11dGYtOA=='));if (!$this->checkAuth()){echo 'ç½‘ç«™æœªæˆæƒï¼Œéœ€è¦æˆæƒæ‰å¯æ­£å¸¸ä½¿ç”¨ï¼Œå®˜ç½‘ç”³è¯· <a href="http:\\/\\/www.tkjidi.com" target="_blank">www.tkjidi.com</a>  å’¨è¯¢å®¢æœQQ 800061081';exit();}}public function index(){$hpzcate =array('all' => 'å…¨éƒ¨', 'nvzhuang' => 'å¥³è£…', 'nanzhuang' => 'ç”·è£…', 'muying' => 'æ¯å©´', 'xiebao' => 'é‹åŒ…', 'jiaju' => 'å±…å®¶', 'meishi' => 'ç¾é£Ÿ', 'peishi' => 'é…é¥°', 'nine' => 'ä¹å—ä¹', 'qita' => 'å…¶ä»–');$this->assign('hpzcate', $hpzcate);$this->display();}public function setting(){if (IS_POST){$cate_id =$this->_post('cate_id', 'trim');$hpz_cate_id =$this->_post('hpz_cate_id', 'trim');$fors =$this->_post('fors', 'trim');$coupon_start_time =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($_POST['coupon_start_time']);$coupon_end_time =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($_POST['coupon_end_time']);if (!$hpz_cate_id){$this->ajaxReturn(0, 'é‡‡é›†åˆ†ç±»å¿…é¡»é€‰æ‹©ï¼');}if (!$cate_id){$this->ajaxReturn(0, 'å…¥åº“åˆ†ç±»å¿…é¡»é€‰æ‹©ï¼');}$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('aHB6X3NldHRpbmc='), array(base64_decode('Y2F0ZV9pZA==') => $cate_id, 'coupon_start_time' => $coupon_start_time, 'coupon_end_time' => $coupon_end_time, 'cid' => $hpz_cate_id, 'fors' => $fors,));$this->collect();}}public function collect(){if (false === $setting =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('hpz_setting')){$this->ajaxReturn(0, L('illegal_parameters'));}$p =$this->_get('p', 'intval', 1);if ($setting['fors'] == 1){$url ='http://outer.huipinzhe.com/api/itemlist/list?cat=' . $setting['cid'] . '&page=' . $p;if ($p == 1){$totalcoll =0;}else {$totalcoll =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('totalcoll');}$coll =0;$source =$GLOBALS['phpjiami_decrypt']['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']($url);$jsondata =json_decode($source, true);if ($jsondata['pageinfo']['total'] == 0){$this->ajaxReturn(0, 'è¯¥ç±»ç›®æš‚æ—¶æ²¡æœ‰ç‰¹ä»·å•†å“');}foreach ($jsondata['list'] as $key => $item){$itemarray['shop_type'] =$item['source'] == 'æ·˜å®' ? 'C' : 'B';$itemarray['title'] =$item['item_name'];$itemarray['tags'] =$tag;$itemarray['cu'] =$item['reduction'];$itemarray['pic_url'] =$GLOBALS['phpjiami_decrypt']['Áı®‹Á¾¯ÖÃÀÄÖÃ®ÖÃÃ®¾À¾Ã¾ÃÃÁˆ¾®Ã¥Ã']('https://', 'http://', $item['imgurl']);$itemarray['num_iid'] =$item['item_id'];$itemarray['price'] =$item['taobao_price'];$itemarray['coupon_price'] =$item['price'];$itemarray['volume'] =$item['viewtotal'];$itemarray['nick'] ='';$itemarray['sellerId'] =$item['viewtotal'];$itemarray['ems'] =$ems;$itemarray['likes'] =$item['viewtotal'];$itemarray['cate_id'] =$setting['cate_id'];$itemarray['item_url'] =$item['taobao_url'];$itemarray['sex'] =$item['viewtotal'];$itemarray['coupon_rate'] =$item['discount'] * 1000;$itemarray['coupon_end_time'] =$setting['coupon_end_time'];$itemarray['coupon_start_time'] =$setting['coupon_start_time'];if ($itemarray['title'] && $itemarray['pic_url'] && $itemarray['num_iid']){$result['item_list'][] =$itemarray;}}}foreach ($result['item_list'] as $key => $val){$res =$this->_ajax_tb_publish_insert($val);if ($res > 0){$coll++;}$totalcoll++;}if ($jsondata['pageinfo']['page'] == $jsondata['pageinfo']['pagecount']){$this->ajaxReturn(0, 'å·²ç»é‡‡é›†å®Œæˆ' . $p . 'é¡µ,æœ¬æ¬¡é‡‡é›†åˆ°' . $totalcoll . 'ä»¶å•†å“ï¼è¯·è¿”å›ï¼Œè°¢è°¢ ');}$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('dG90YWxjb2xs'), $totalcoll);$this->assign('p', $p);$this->assign('coll', $coll);$this->assign('totalnum', $totalnum);$this->assign('totalcoll', $totalcoll);$resp =$this->fetch('collect');$this->ajaxReturn(1, '', $resp);}private function _ajax_tb_publish_insert($item){$item['title'] =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($GLOBALS['phpjiami_decrypt']['Ö¾ıÁˆÄÁÖı®Ã¯Öı¯ı¥¾Ã‹ÃÁÄ®¥ÄÄÄ‹Ã‹']($item['title']));$result =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('items')->ajax_yg_publish($item);return $result;}}