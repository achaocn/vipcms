<?php global $phpjiami_decrypt;$phpjiami_decrypt['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']=base64_decode('X2luaXRpYWxpemU=');$phpjiami_decrypt['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']=base64_decode('c3RydG90aW1l');$phpjiami_decrypt['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']=base64_decode('dHJpbQ==');$phpjiami_decrypt['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']=base64_decode('Rg==');$phpjiami_decrypt['ııÖˆı¥‹ˆ”Ã”¾ÃÖ‹ÃÖˆÁ¯À‹¾”À‹ı”']=base64_decode('dXJsZW5jb2Rl');$phpjiami_decrypt['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']=base64_decode('dGltZQ==');$phpjiami_decrypt['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']=base64_decode('ZmlsZV9nZXRfY29udGVudHM=');$phpjiami_decrypt['¯‹‹Ã¯¯®Ã¯ÃÀÁÃ”Ã‹®”Ã¥À¥ˆÃÁÖÄ‹ÖÖ']=base64_decode('cm91bmQ=');$phpjiami_decrypt['®¥ÃÄı®¾Ã®ÖÖÄÃ¥ÃÃˆıı¾ÄÁ¾ÃÀ‹']=base64_decode('cmFuZA==');$phpjiami_decrypt['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']=base64_decode('RA==');$phpjiami_decrypt['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']=base64_decode('aW1wbG9kZQ==');$phpjiami_decrypt['Ö¾ıÁˆÄÁÖı®Ã¯Öı¯ı¥¾Ã‹ÃÁÄ®¥ÄÄÄ‹Ã‹']=base64_decode('c3RyaXBfdGFncw=='); ?>
<?php
 class tejiahaohuoAction extends BackendAction {public function _initialize(){parent::$GLOBALS['phpjiami_decrypt']['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']();$this->_cate_mod =D('items_cate');}public function index(){$cat_url ='http://pub.alimama.com/items/channel/tehui.json?channel=tehui';$ftxia_https =new ftxia_https();$source =$ftxia_https->results;if (!$source){$cat_source =$this->doRequest($cat_url);}$cat_data =json_decode($cat_source, true);$this->assign('cat_list', $cat_data['data']['navigator']);$copy_right =array('title' => '<div style="position: fixed;bottom:10px;right: 0px;"></div>');$this->assign('copy_right', $copy_right);$this->display();}public function setting(){if (IS_POST){$cat =$this->_post('cat', 'trim');$cate_id =$this->_post('cate_id', 'trim');$startTkRate =$this->_post('startTkRate', 'trim');$endTkRate =$this->_post('endTkRate', 'trim');$user_type =$this->_post('user_type', 'trim');$page =$this->_post('page', 'trim');$start_price =$this->_post('start_price', 'trim');$end_price =$this->_post('end_price', 'trim');$loc =$this->_post('loc', 'trim');$coupon_start_time =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($_POST['coupon_start_time']);$coupon_end_time =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($_POST['coupon_end_time']);$sort =$this->_post('sort', 'trim');$ems =$this->_post('ems', 'trim');$sex =$this->_post('sex', 'trim');$volume =$this->_post('startBiz30day', 'trim');if (!$cat || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($cat)){$this->ajaxReturn(0, 'é‡‡é›†åˆ†ç±»å¿…é¡»é€‰æ‹©ï¼');}if (!$cate_id || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($cate_id)){$this->ajaxReturn(0, 'å…¥åº“åˆ†ç±»å¿…é¡»é€‰æ‹©ï¼');}if ($start_price > $end_price){$this->ajaxReturn(0, 'æœ€ä½ä»·æ ¼ä¸èƒ½é«˜äºæœ€é«˜ä»·æ ¼');}if ($startTkRate < 1 && $startTkRate > 99){$this->ajaxReturn(0, 'ä½£é‡‘æ¯”ç‡è¯·å¡«å†™1-99ä¹‹é—´çš„æ•´æ•°');}if ($startRlRate < 100 && $startRlRate > 10000){$this->ajaxReturn(0, 'æŠ˜æ‰£æ¯”ç‡è¯·å¡«å†™100-10000ä¹‹é—´çš„æ•´æ•°');}$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('dGVqaWFoYW9odW9fc2V0dGluZw=='), array(base64_decode('Y2F0ZV9pZA==') => $cate_id, 'cat' => $cat, 'start_price' => $start_price, 'end_price' => $end_price, 'startTkRate' => $startTkRate, 'endTkRate' => $endTkRate, 'user_type' => $user_type, 'page' => $page, 'sort' => $sort, 'loc' => $loc, 'ems' => $ems, 'hPayRate30' => $hPayRate30, 'volume' => $volume, 'sex' => $sex, 'coupon_start_time' => $coupon_start_time, 'coupon_end_time' => $coupon_end_time));$this->collect();}}public function collect(){$source ='';if (false === ($setting =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('tejiahaohuo_setting'))){$this->ajaxReturn(0, L('illegal_parameters'));}$p =$this->_get('p', 'intval', 1);$coll =0;if ($p == 1){$totalcoll =0;$order_num =0;}else {$totalcoll =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('totalcoll');$order_num =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('order_num');}if ($p > $setting['page']){if ($p > 1){$p =$p - 1;}$this->ajaxReturn(0, 'å·²ç»é‡‡é›†å®Œæˆ' . $p . 'é¡µ,æœ¬æ¬¡é‡‡é›†åˆ°' . $order_num . 'ä»¶å•†å“ï¼è¯·è¿”å›ï¼Œè°¢è°¢');}$url ='http://pub.alimama.com/items/channel/tehui.json?channel=tehui&level=1' . '&toPage=' . $p . '&perPageSize=50&catIds=' . $setting['cat'] . '&sortType=' . $setting['sort'] . '&freeShipment=' . $setting['ems'] . '&userType=' . $setting['user_type'] . '&startBiz30day=' . $setting['volume'] . '&startTkRate=' . $setting['startTkRate'] . '&endTkRate=' . $setting['endTkRate'] . '&startPrice=' . $setting['start_price'] . '&endPrice=' . $setting['end_price'] . '&loc=' . $GLOBALS['phpjiami_decrypt']['ııÖˆı¥‹ˆ”Ã”¾ÃÖ‹ÃÖˆÁ¯À‹¾”À‹ı”']($setting['loc']). '&freeShipment=' . $setting['ems'] . '&_t=' . $GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹'](). '&_tb_token_=test';$ftxia_https =new ftxia_https();$ftxia_https->fetch($url);$source =$ftxia_https->results;if (!$source){$source =$GLOBALS['phpjiami_decrypt']['Ãı®ÃÄˆÖıˆ‹À¾ÄÖÀÄ¥Öı¯ÀÃÖ¾”¾Ã¾”']($url);}$result_data =json_decode($source, true);$jobn =array();if ($source){for ($i =0;$i < 50;$i++){$jobn['title'] =$result_data['data']['pageList'][$i]['title'];$jobn['img'] =$result_data['data']['pageList'][$i]['pictUrl'];$jobn['iid'] =$result_data['data']['pageList'][$i]['auctionId'];$jobn['price'] =$result_data['data']['pageList'][$i]['reservePrice'];$jobn['url'] =$result_data['data']['pageList'][$i]['auctionUrl'];$jobn['zkprice'] =$result_data['data']['pageList'][$i]['zkPrice'];$jobn['volume'] =$result_data['data']['pageList'][$i]['biz30day'];$jobn['nick'] =$result_data['data']['pageList'][$i]['nick'];$jobn['sellerId'] =$result_data['data']['pageList'][$i]['sellerId'];$jobn['commission_rate'] =$result_data['data']['pageList'][$i]['tkRate'];$jobn['commission'] =$result_data['data']['pageList'][$i]['tkCommFee'];$jobn['totalFee'] =$result_data['data']['pageList'][$i]['totalFee'];$jobn['shoptype'] =$result_data['data']['pageList'][$i]['userType'];$shoptype =$jobn['shoptype'];if ($shoptype == 0){$shop_type ='C';}else {$shop_type ='B';}$zkou =$GLOBALS['phpjiami_decrypt']['¯‹‹Ã¯¯®Ã¯ÃÀÁÃ”Ã‹®”Ã¥À¥ˆÃÁÖÄ‹ÖÖ']($jobn['zkprice'] / $jobn['price'] * 10, 1);$coupon_rate =$zkou * 1000;$likes =$GLOBALS['phpjiami_decrypt']['®¥ÃÄı®¾Ã®ÖÖÄÃ¥ÃÃˆıı¾ÄÁ¾ÃÀ‹'](99, 9999);$title =$jobn['title'];$img =$jobn['img'];$iid =$jobn['iid'];$num =$GLOBALS['phpjiami_decrypt']['®¥ÃÄı®¾Ã®ÖÖÄÃ¥ÃÃˆıı¾ÄÁ¾ÃÀ‹'](1, 50);$volume =$jobn['volume'] + $num;$tag_list =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('items')->get_tags_by_title($title);$tags =$GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ'](',', $tag_list);$itemarray['shop_type'] =$shop_type;$itemarray['title'] =$title;$itemarray['item_url'] =$jobn['url'];$itemarray['tags'] =$tags;$itemarray['pic_url'] =$img;$itemarray['num_iid'] =$iid;$itemarray['price'] =$jobn['price'];$itemarray['coupon_price'] =$jobn['zkprice'];$itemarray['volume'] =$volume;$itemarray['nick'] =$jobn['nick'];$itemarray['sellerId'] =$jobn['sellerId'];$itemarray['ems'] =$setting['ems'];$itemarray['commission'] =$jobn['commission'];$itemarray['commission_rate'] =$jobn['commission_rate'];$itemarray['yj'] =$jobn['totalFee'];$itemarray['likes'] =$likes;$itemarray['cate_id'] =$setting['cate_id'];$itemarray['sex'] =$setting['sex'];$itemarray['coupon_rate'] =$coupon_rate;$itemarray['coupon_end_time'] =$setting['coupon_end_time'];$itemarray['coupon_start_time'] =$setting['coupon_start_time'];if ($title && $img && $iid){$result['item_list'][] =$itemarray;}}}else {$result['msg'] ='é‡‡é›†ç»“æŸï¼è¯·è¿”å›!';}foreach ($result['item_list'] as $key => $val){$res =$this->_ajax_tb_publish_insert($val);if ($res > 0){$coll++;$order_num++;}$totalcoll++;}$result['msg'] ='ç‰¹ä»·å¥½è´§é‡‡é›†å™¨';$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('dG90YWxjb2xs'), $totalcoll);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('b3JkZXJfbnVt'), $order_num);$this->assign('p', $p);$this->assign('coll', $coll);$this->assign('order_num', $order_num);$this->assign('totalcoll', $totalcoll);$resp =$this->fetch('collect');$this->ajaxReturn(1, $result['msg'], $resp);}private function _ajax_tb_publish_insert($item){$item['title'] =$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($GLOBALS['phpjiami_decrypt']['Ö¾ıÁˆÄÁÖı®Ã¯Öı¯ı¥¾Ã‹ÃÁÄ®¥ÄÄÄ‹Ã‹']($item['title']));$result =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('items')->ajax_yg_publish($item);return $result;}public function doRequest($url){$ch =curl_init();curl_setopt($ch, CURLOPT_URL, $url);curl_setopt($ch, CURLOPT_HEADER, 0);curl_setopt($ch, CURLOPT_USERAGENT, $_SERVER['HTTP_USER_AGENT']);curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);curl_setopt($ch, CURLOPT_REFERER, $_SERVER['HTTP_HOST']);curl_setopt($ch, CURLOPT_COOKIEJAR, 'cookie.txt');curl_setopt($ch, CURLOPT_COOKIEFILE, 'cookie.txt');$data =curl_exec($ch);curl_close($ch);return $data;}}