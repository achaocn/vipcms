<?php global $phpjiami_decrypt;$phpjiami_decrypt['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']=base64_decode('X2luaXRpYWxpemU=');$phpjiami_decrypt['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']=base64_decode('TQ==');$phpjiami_decrypt['¯¯”‹¯¯¾®¥Ã”®ÄıÁ¥¯”Ãˆ¥Ã‹”®¯¾ˆ®']=base64_decode('aGVhZGVy');$phpjiami_decrypt['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']=base64_decode('Rg==');$phpjiami_decrypt['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']=base64_decode('SQ==');$phpjiami_decrypt['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']=base64_decode('dHJpbQ==');$phpjiami_decrypt['¥®ı¯ÀÀˆ¯¾Ö”Ö‹ÖÁˆıÄ¾Ö‹ÃıÃˆ®¥ıı‹‹']=base64_decode('ZnVuY3Rpb25fZXhpc3Rz');$phpjiami_decrypt['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']=base64_decode('dGltZQ==');$phpjiami_decrypt['‹¥ı‹”ÖÁÁÃ¾”¥®ÖÁ”Ö‹Ö¯ˆ‹ÄÖÖ‹ÖÖ‹']=base64_decode('aXNfYXJyYXk=');$phpjiami_decrypt['ÃÃÄ”Ö®ÁıÀÃÄÃ¥ÄÖ”Ö‹Ö¥ÃÄ¥®ˆÄÖ¾Á']=base64_decode('Qw==');$phpjiami_decrypt['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']=base64_decode('c3RydG90aW1l');$phpjiami_decrypt['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']=base64_decode('ZGF0ZQ==');$phpjiami_decrypt['ˆı¾ÖÁÀÖ”Ãˆ‹ıÄ®ˆ‹ˆ¯¯ÀÁ¯®Ã¯‹Ö”®ÖˆÀ']=base64_decode('bGVmdHRpbWU=');$phpjiami_decrypt['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']=base64_decode('RA==');$phpjiami_decrypt['”‹¥Ö¯Ö‹ıÁ®ÖÀ®¾¾ÄÖˆ®Ä¯”ı¾‹¾ÄÃıÃ']=base64_decode('aW50dmFs');$phpjiami_decrypt['¯‹‹Ã¯¯®Ã¯ÃÀÁÃ”Ã‹®”Ã¥À¥ˆÃÁÖÄ‹ÖÖ']=base64_decode('cm91bmQ=');$phpjiami_decrypt['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ']=base64_decode('aW1wbG9kZQ==');$phpjiami_decrypt['Áı®ÃÄ®Ã‹À¾ÄÁÄı‹ÃÖÁıÃÁÖ®¾ÃÃ®‹¯Ã¥']=base64_decode('dmVuZG9y'); ?>
<?php
 class robotsAction extends BackendAction {private $_tbconfig =null;private $_ftxconfig =null;public function _initialize(){parent::$GLOBALS['phpjiami_decrypt']['¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥”ÃÃı®¥®ÄÄ¯Ã¯¥Öˆ']();$this->_mod =D('robots');$this->_cate_mod =D('items_cate');$api_config =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('items_site')->where(array('code' => 'taobao'))->getField('config');$this->_tbconfig =unserialize($api_config);$ftxapi_config =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('items_site')->where(array('code' => 'ftxia'))->getField('config');$this->_ftxconfig =unserialize($ftxapi_config);$GLOBALS['phpjiami_decrypt']['¯¯”‹¯¯¾®¥Ã”®ÄıÁ¥¯”Ãˆ¥Ã‹”®¯¾ˆ®'](base64_decode('Q29udGVudC1UeXBlOnRleHQvaHRtbDsgY2hhcnNldD11dGYtOA=='));if (!$this->checkAuth()){echo 'ç½‘ç«™æœªæˆæƒï¼Œéœ€è¦æˆæƒæ‰å¯æ­£å¸¸ä½¿ç”¨ï¼Œå®˜ç½‘ç”³è¯· <a href="http:\\/\\/www.tkjidi.com" target="_blank">www.tkjidi.com</a>  å’¨è¯¢å®¢æœQQ 800061081';exit();}}public function _before_index(){$big_menu =array('title' => '<div style="position: fixed;bottom:30px;right: 0px;"><a href="http://www.tkjidi.com" target="_blank">@æ·˜å®¢åŸºåœ°ç‰ˆæƒæ‰€æœ‰ </a></div>',);$this->assign('big_menu', $big_menu);$res =$this->_cate_mod->field('id,name')->select();$cate_list =array();foreach ($res as $val){$cate_list[$val['id']] =$val['name'];}$this->assign('cate_list', $cate_list);$robots_collect_data =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('robots_collect_data');$this->assign('robots_collect_data', $robots_collect_data);$this->sort ='ordid ASC,';$this->order ='last_time DESC';}public function add(){if (IS_POST){$name =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('name', '', 'trim');$cid =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('cid', '', 'trim');$recid =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('recid', '', 'trim');$cate_id =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('cate_id', '', 'trim');$keyword =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('keyword', '', 'trim');$page =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('page', '1', 'trim');$sort =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('sort', 'normal', 'trim');$start_commissionRate =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('start_commissionRate', '10', 'trim');$end_commissionRate =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('end_commissionRate', '9999', 'trim');$start_price =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('start_price', '0', 'trim');$end_price =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('end_price', '99999', 'trim');$shop_type =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('shop_type', 'all', 'trim');if (!$name || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($name)){$this->error('è¯·å¡«å†™é‡‡é›†å™¨åç§°');}if (!$cate_id || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($cate_id)){$this->error('è¯·é€‰æ‹©å•†å“åˆ†ç±»');}if (!$keyword && !$cid){$this->error('è¯·å¡«å†™å…³é”®è¯æˆ–é€‰æ‹©APIåˆ†ç±»');}if ($start_commissionRate > $end_commissionRate){$this->error('èµ·å§‹ä½£é‡‘ä¸èƒ½é«˜äºæœ€é«˜ä½£é‡‘');}$data['name'] =$name;$data['cid'] =$cid;$data['recid'] =$recid;$data['cate_id'] =$cate_id;$data['keyword'] =$keyword;$data['page'] =$page;$data['sort'] =$sort;$data['start_commissionRate'] =$start_commissionRate;$data['end_commissionRate'] =$end_commissionRate;$data['start_price'] =$start_price;$data['end_price'] =$end_price;$data['shop_type'] =$shop_type;$this->_mod->create($data);$item_id =$this->_mod->add();$this->success('æ·»åŠ æˆåŠŸï¼');}}public function edit(){if (IS_POST){$id =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('id', '', 'trim');$name =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('name', '', 'trim');$cid =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('cid', '', 'trim');$recid =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('recid', '', 'trim');$cate_id =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('cate_id', '', 'trim');$keyword =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('keyword', 'trim');$page =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('page', '', 'trim');$sort =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('sort', '', 'trim');$start_commissionRate =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('start_commissionRate', '', 'trim');$end_commissionRate =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('end_commissionRate', '', 'trim');$start_price =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('start_price', '', 'trim');$end_price =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('end_price', '', 'trim');$shop_type =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('shop_type', 'all', 'trim');if (!$name || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($name)){$this->error('è¯·å¡«å†™é‡‡é›†å™¨åç§°');}if (!$cate_id || !$GLOBALS['phpjiami_decrypt']['¯ˆÖıÃ®À¥¯ÖÁÖˆ‹¥ÖÃ®¥Ã¥ıÄÖÁÖÁÖ‹¯®Ã']($cate_id)){$this->error('è¯·é€‰æ‹©å•†å“åˆ†ç±»');}if (!$keyword && !$cid){$this->error('è¯·å¡«å†™å…³é”®è¯æˆ–é€‰æ‹©å¡«å†™æ·˜å®åˆ†ç±»id');}if ($start_commissionRate > $end_commissionRate){$this->error('èµ·å§‹ä½£é‡‘ä¸èƒ½é«˜äºæœ€é«˜ä½£é‡‘');}$data['name'] =$name;$data['cid'] =$cid;$data['recid'] =$recid;$data['cate_id'] =$cate_id;$data['keyword'] =$keyword;$data['page'] =$page;$data['sort'] =$sort;$data['start_commissionRate'] =$start_commissionRate;$data['end_commissionRate'] =$end_commissionRate;$data['start_price'] =$start_price;$data['end_price'] =$end_price;$data['shop_type'] =$shop_type;$this->_mod->where(array('id' => $id))->save($data);$this->success(L('operation_success'));}else {$id =$this->_get('id', 'intval');$item =$this->_mod->where(array('id' => $id))->find();$spid =$this->_cate_mod->where(array('id' => $item['cate_id']))->getField('spid');if ($spid == 0){$spid =$item['cate_id'];}else {$spid .= $item['cate_id'];}$this->assign('selected_ids', $spid);$this->assign('info', $item);$orig_list =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄıÁ‹Ãıı®ıˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃ¥Àı']('items_orig')->select();$this->assign('orig_list', $orig_list);if (!$GLOBALS['phpjiami_decrypt']['¥®ı¯ÀÀˆ¯¾Ö”Ö‹ÖÁˆıÄ¾Ö‹ÃıÃˆ®¥ıı‹‹'](base64_decode('Y3VybF9nZXRpbmZv'))){$this->error(L('curl_not_open'));}$items_cate =$this->_get_tbcats();$this->assign('items_cate', $items_cate);$this->display();}}public function add_do(){if (!$GLOBALS['phpjiami_decrypt']['¥®ı¯ÀÀˆ¯¾Ö”Ö‹ÖÁˆıÄ¾Ö‹ÃıÃˆ®¥ıı‹‹']("curl_getinfo")){$this->error(L('curl_not_open'));}$items_cate =$this->_get_tbcats();$this->assign('items_cate', $items_cate);$this->display();}public function collect(){$id =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('id', '', 'intval');$auto =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('auto', 0, 'intval');$p =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('p', 1, 'intval');if ($auto){if (!$this->_tbconfig['app_key']){$this->ajaxReturn(0, 'è¯·è®¾ç½®æ·˜å®appkey');}$rid =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('rid', 0, 'intval');$robots_collect_data['rid'] =$rid;$robots_collect_data['p'] =$p;$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('cm9ib3RzX2NvbGxlY3RfZGF0YQ=='), $robots_collect_data);if (false === $GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('cm9ib3RzX3RpbWU='))){$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('cm9ib3RzX3RpbWU='), $GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']());}if (!$rid){$where['status'] =1;$taorobots =$this->_mod->where($where)->order('ordid asc')->select();$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('dGFvcm9ib3Rz'), $taorobots);$rid =0;}$taorobots =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('taorobots');$date =$taorobots[$rid];if (!$date){$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('totalcoll', NULL);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('cm9ib3RzX3RpbWU='), NULL);$this->ajaxReturn(0, 'ä¸€é”®å…¨è‡ªåŠ¨å·²ç»é‡‡é›†å®Œæˆï¼è¯·è¿”å›ï¼Œè°¢è°¢');}if ($p > $date['page']){$p =1;$rid =$rid + 1;$date =$taorobots[$rid];if (!$date){$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('totalcoll', NULL);$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('cm9ib3RzX3RpbWU='), NULL);$this->ajaxReturn(0, 'ä¸€é”®å…¨è‡ªåŠ¨å·²ç»é‡‡é›†å®Œæˆï¼è¯·è¿”å›ï¼Œè°¢è°¢');}}$np =$p + 1;$result_data =$this->api_collect($date, $p);$this->assign('result_data', $result_data);$msg['title'] ='ä¸€é”®å…¨è‡ªåŠ¨é‡‡é›†';$msg['np'] =$np;$msg['rid'] =$rid;$this->assign('date', $date);$this->assign('ftxrobots_count', count($taorobots));$this->assign('rids', $rid + 1);$resp =$this->fetch('auto_collect');$this->ajaxReturn(1, $msg, $resp);}else {$date =$this->_mod->where(array('id' => $id))->find();$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('cm9ib3Rfc2V0dGluZw=='), $date);}if ($date){if (!$this->_tbconfig['app_key']){$this->ajaxReturn(0, 'è¯·è®¾ç½®æ·˜å®appkey');}if ($p > $date['page']){$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('totalcoll', NULL);$this->ajaxReturn(0, 'å·²ç»é‡‡é›†å®Œæˆ' . $date['page'] . 'é¡µï¼è¯·è¿”å›ï¼Œè°¢è°¢');}$result_data =$this->api_collect($date, $p);$this->assign('result_data', $result_data);$resp =$this->fetch('collect');$this->ajaxReturn(1, '', $resp);}else {$this->ajaxReturn(0, 'error');}}public function api_collect($date, $p){$this->_mod->where(array('id' => $date['id']))->save(array('last_page' => $p, 'last_time' => time()));if (false === $totalcoll =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('totalcoll')){$totalcoll =0;}if (false === $robots_time =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('robots_time')){$robots_time =$GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']();$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('cm9ib3RzX3RpbWU='), $GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']());}$map['keyword'] =$date['keyword'];$map['cid'] =$date['cid'];$map['cate_id'] =$date['cate_id'];if ($date['start_commissionRate'] < 100){$map['start_commissionRate'] =($date['start_commissionRate'] * 100);}else {$map['start_commissionRate'] =$date['start_commissionRate'];}if ($date['end_commissionRate'] < 100){$map['end_commissionRate'] =($date['end_commissionRate'] * 100);}else {$map['end_commissionRate'] =$date['end_commissionRate'];}$map['start_price'] =$date['start_price'];$map['end_price'] =$date['end_price'];$map['shop_type'] =$date['shop_type'];$map['recid'] =$date['recid'];$map['sort'] =$date['sort'];$result =$this->_get_list($map, $p);$taobaoke_item_list =$result['item_list'];$totalnum =$result['count'];$coll =0;$thiscount =0;if ($GLOBALS['phpjiami_decrypt']['‹¥ı‹”ÖÁÁÃ¾”¥®ÖÁ”Ö‹Ö¯ˆ‹ÄÖÖ‹ÖÖ‹']($taobaoke_item_list)){$msg ='æˆåŠŸï¼';}else {$msg ='å¤±è´¥ï¼';}foreach ($taobaoke_item_list as $key => $val){$coupon_add_time =$GLOBALS['phpjiami_decrypt']['ÃÃÄ”Ö®ÁıÀÃÄÃ¥ÄÖ”Ö‹Ö¥ÃÄ¥®ˆÄÖ¾Á']('ftx_coupon_add_time');if ($coupon_add_time){$times =(int)($GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($GLOBALS['phpjiami_decrypt']['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']("Y-m-d H:00:00", $GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()))+ $coupon_add_time * 3600);}else {$times =(int)($GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($GLOBALS['phpjiami_decrypt']['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']("Y-m-d H:00:00", $GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()))+ 72 * 86400);}$val['coupon_start_time'] =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($GLOBALS['phpjiami_decrypt']['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']("Y-m-d H:00:00", $GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()));$val['coupon_end_time'] =$times;$val['astime'] =$GLOBALS['phpjiami_decrypt']['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']("Ymd");$val['recid'] =$map['recid'];$res =$this->_ajax_ftx_publish_insert($val);if ($res > 0){$coll++;$totalcoll++;}$thiscount++;}$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('dG90YWxjb2xs'), $totalcoll);$result_data['p'] =$p;$result_data['msg'] =$msg;$result_data['coll'] =$coll;$result_data['totalcoll'] =$totalcoll;$result_data['totalnum'] =$totalnum;$result_data['thiscount'] =$thiscount;$result_data['times'] =$GLOBALS['phpjiami_decrypt']['ˆı¾ÖÁÀÖ”Ãˆ‹ıÄ®ˆ‹ˆ¯¯ÀÁ¯®Ã¯‹Ö”®ÖˆÀ']($GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()- $robots_time);return $result_data;}private function _ajax_ftx_publish_insert($item){$result =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾‹‹Á‹¾']('items')->ajax_ftx_publish($item);return $result;}private function _get_list($map, $p){$tb_top =$this->_get_tb_top();$req =$tb_top->load_api('TbkItemGetRequest');$req->setFields('num_iid,title,nick,pict_url,volume,reserve_price,zk_final_price,user_type,item_url,seller_id');$req->setPageSize('40');$req->setPageNo($p);$map['keyword'] && $req->setQ($map['keyword']);$map['cid'] && $req->setCat($map['cid']);if ($map['start_price'] && $map['end_price']){$req->setStartPrice(intval($map['start_price']));$req->setEndPrice(intval($map['end_price']));}$map['start_commissionRate'] && $req->setStartTkRate($map['start_commissionRate']);$map['end_commissionRate'] && $req->setEndTkRate($map['end_commissionRate']);if ($map['shop_type'] == 'B'){$req->setIsTmall('true');}$map['sort'] && $req->setSort($map['sort']);$resp =$tb_top->execute($req);$count =$resp->total_results;$taobaoke_item_list =array();$resp_items =(array)$resp->results;if (!$resp_items){return array('count' => $GLOBALS['phpjiami_decrypt']['”‹¥Ö¯Ö‹ıÁ®ÖÀ®¾¾ÄÖˆ®Ä¯”ı¾‹¾ÄÃıÃ']($count), 'item_list' => $taobaoke_item_list,);$resul =(array)$resp;$this->ajaxReturn(0, $resul['msg']);}$iids ='';foreach ($resp_items['n_tbk_item'] as $val){$val =(array)$val;$iid =(string)$val['num_iid'];$val['cate_id'] =$map['cate_id'];$val['nick'] =$val['nick'];$val['pic_url'] =$val['pict_url'];$val['price'] =$val['reserve_price'];$val['coupon_price'] =$val['zk_final_price'];$val['coupon_rate'] =$GLOBALS['phpjiami_decrypt']['¯‹‹Ã¯¯®Ã¯ÃÀÁÃ”Ã‹®”Ã¥À¥ˆÃÁÖÄ‹ÖÖ']($val['coupon_price'] / $val['price'], 4)* 10000;$val['sellerId'] =$val['seller_id'];$val['volume'] =$val['volume'];$val['ems'] =1;if ($val['user_type']){$val['shop_type'] ='B';}else {$val['shop_type'] ='C';}unset($val['reserve_price']);unset($val['zk_final_price']);unset($val['seller_id']);unset($val['pict_url']);unset($val['user_type']);$taobaoke_item_list[$iid] =$val;}return array(base64_decode('Y291bnQ=') => $GLOBALS['phpjiami_decrypt']['”‹¥Ö¯Ö‹ıÁ®ÖÀ®¾¾ÄÖˆ®Ä¯”ı¾‹¾ÄÃıÃ']($count), 'item_list' => $taobaoke_item_list,);}public function item_check(){$this->display();}public function item_checks(){$this->item_mod =m("items");$p =$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯ˆıı”Ã®Á”¯‹Ä¥ÁÃÁ”']('p', 1, 'intval');$where['coupon_end_time'] =array("elt", $GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']());$where['pass'] ="1";$page_size =40;if (false === $itemcheckdata =$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ']('itemcheck')){$itemcheckdata['this_good'] =0;$itemcheckdata['this_bad'] =0;$itemcheckdata['that_good'] =0;$itemcheckdata['that_bad'] =0;$itemcheckdata['total'] =0;$itemcheckdata['not_total'] =0;$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('aXRlbWNoZWNr'), $itemcheckdata);}$itemcheckdata['this_good'] =0;$itemcheckdata['this_bad'] =0;$CheckItemCount =$this->item_mod->where($where)->count("id");$itemcheckdata['not_total'] =$CheckItemCount;$order ="add_time asc ";$items_list =$this->item_mod->field('num_iid')->where($where)->order($order)->limit(0, $page_size)->select();$arr_iids =array();if ($items_list){foreach ($items_list as $key => $val){$item =array();$arr_iids[] =$val['num_iid'];$item['status'] ='sellout';$item['num_iid'] =$val['num_iid'];$taobaoke_item_list[$val['num_iid']] =$item;}}else {$this->ajaxReturn(0, 'æ›´æ–°å®Œæˆï¼Œè°¢è°¢ï¼');}$num_iids =$GLOBALS['phpjiami_decrypt']['ÃÁ¥ÃÖÄˆ®Ö¾¾‹¯ÄˆÖÖÁ”Ö¥¯¯Ä¾ÀˆÄˆ'](',', $arr_iids);if (!$this->_tbconfig['app_key']){$this->ajaxReturn(0, 'è¯·è®¾ç½®æ·˜å®appkey');}$tb_tops =$this->_get_tb_top();$reqs =$tb_tops->load_api('TbkItemInfoGetRequest');$reqs->setFields('num_iid,title,nick,pict_url,volume,reserve_price,zk_final_price,user_type,item_url,seller_id');$reqs->setNumIids($num_iids);$resps =$tb_tops->execute($reqs);$items =(array)$resps->results;foreach ($items['n_tbk_item'] as $val){$val =(array)$val;$iid =(string)$val['num_iid'];$item =array();$item['num_iid'] =$val['num_iid'];$item['nick'] =$val['nick'];$item['pic_url'] =$val['pict_url'];$item['price'] =$val['reserve_price'];$item['coupon_price'] =$val['zk_final_price'];$item['coupon_rate'] =$GLOBALS['phpjiami_decrypt']['¯‹‹Ã¯¯®Ã¯ÃÀÁÃ”Ã‹®”Ã¥À¥ˆÃÁÖÄ‹ÖÖ']($item['coupon_price'] / $item['price'], 4)* 10000;$item['sellerId'] =$val['seller_id'];$item['status'] ='underway';$item['volume'] =$val['volume'];if ($val['user_type']){$item['shop_type'] ='B';}else {$item['shop_type'] ='C';}$taobaoke_item_list[$iid] =$item;}foreach ($taobaoke_item_list as $val){$coupon_add_time =$GLOBALS['phpjiami_decrypt']['ÃÃÄ”Ö®ÁıÀÃÄÃ¥ÄÖ”Ö‹Ö¥ÃÄ¥®ˆÄÖ¾Á']('ftx_coupon_add_time');if ($coupon_add_time){$times =(int)($GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()+ $coupon_add_time * 3600);}else {$times =(int)($GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()+ 72 * 86400);}if ($val['status'] == 'underway' && $val['coupon_price'] && $val['price']){$val['coupon_start_time'] =$GLOBALS['phpjiami_decrypt']['ıÁˆı”ÖıÃÖÃ‹Á®ˆÖÀ”¥¥‹”ÄÁ”¯¥Á¾¯Ã']($GLOBALS['phpjiami_decrypt']['¾”ıÁ®Ö®ÄÄ¯¾ı‹ÖÁˆÖÖÃÃÁ”¥”Ã¾ÄÄ”Á”']('Y-m-d H:00:00', $GLOBALS['phpjiami_decrypt']['ÁııÃ¯¥‹¯‹®”ıÃ®ÃÁÄ”ÀÖ‹Ã¯ÖÖı¥Ö‹']()));$val['coupon_end_time'] =$times;$itemcheckdata['this_good'] =$itemcheckdata['this_good'] + 1;$itemcheckdata['that_good'] =$itemcheckdata['that_good'] + 1;}else {$val['pass'] =0;$itemcheckdata['this_bad'] =$itemcheckdata['this_bad'] + 1;$itemcheckdata['that_bad'] =$itemcheckdata['that_bad'] + 1;$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('YmFkX2l0ZW0='), $val);}$itemcheckdata['total'] =$itemcheckdata['total'] + 1;$this->item_mod->where(array('num_iid' => (string)$val['num_iid']))->save($val);}$GLOBALS['phpjiami_decrypt']['ÖÃÄÖ¯¥®Ö¾®Ä¾”ÖÃ¯ˆ¥ˆÄ”¯¥ÁÄÄÖ'](base64_decode('aXRlbWNoZWNr'), $itemcheckdata);$msg['title'] ='å•†å“æ£€æµ‹';$msg['p'] =$p + 1;$this->assign('item', $itemcheckdata);$resp =$this->fetch('ajax_itemcheck');$this->ajaxReturn(1, $msg, $resp);}public function ajax_get_tbcats(){$cid =$this->_get('cid', 'intval', 0);$item_cate =$this->_get_tbcats($cid);if ($item_cate){$this->ajaxReturn(1, '', $item_cate);}else {$this->ajaxReturn(0);}}private function _get_tbcats($cid =0){$tb_top =$this->_get_ftx_top();$req =$tb_top->load_api('TaobaoItemcatsGetRequest');$req->setFields("cid,parent_cid,name,is_parent");$req->setParentCid($cid);$req->setTime(date("Y-m-d"));$resp =$tb_top->execute($req);$res_cats =(array)$resp->item_cats;$item_cate =array();foreach ($res_cats['item_cat'] as $val){$val =(array)$val;$item_cate[] =$val;}return $item_cate;}private function _get_tb_top(){$GLOBALS['phpjiami_decrypt']['Áı®ÃÄ®Ã‹À¾ÄÁÄı‹ÃÖÁıÃÁÖ®¾ÃÃ®‹¯Ã¥']('taobao.TopClient');$GLOBALS['phpjiami_decrypt']['Áı®ÃÄ®Ã‹À¾ÄÁÄı‹ÃÖÁıÃÁÖ®¾ÃÃ®‹¯Ã¥'](base64_decode('dGFvYmFvLlJlcXVlc3RDaGVja1V0aWw='));$GLOBALS['phpjiami_decrypt']['Áı®ÃÄ®Ã‹À¾ÄÁÄı‹ÃÖÁıÃÁÖ®¾ÃÃ®‹¯Ã¥'](base64_decode('dGFvYmFvLlJlc3VsdFNldA=='));$tb_top =new TopClient;$tb_top->appkey =$this->_tbconfig['app_key'];$tb_top->secretKey =$this->_tbconfig['app_secret'];return $tb_top;}private function _get_ftx_top(){$GLOBALS['phpjiami_decrypt']['Áı®ÃÄ®Ã‹À¾ÄÁÄı‹ÃÖÁıÃÁÖ®¾ÃÃ®‹¯Ã¥']('Ftxia.TopClient');$GLOBALS['phpjiami_decrypt']['Áı®ÃÄ®Ã‹À¾ÄÁÄı‹ÃÖÁıÃÁÖ®¾ÃÃ®‹¯Ã¥'](base64_decode('RnR4aWEuUmVxdWVzdENoZWNrVXRpbA=='));$GLOBALS['phpjiami_decrypt']['Áı®ÃÄ®Ã‹À¾ÄÁÄı‹ÃÖÁıÃÁÖ®¾ÃÃ®‹¯Ã¥'](base64_decode('RnR4aWEuTG9nZ2Vy'));$ftx_top =new TopClient;$ftx_top->appkey =$this->_ftxconfig['app_key'];$ftx_top->secretKey =$this->_ftxconfig['app_secret'];return $ftx_top;}}