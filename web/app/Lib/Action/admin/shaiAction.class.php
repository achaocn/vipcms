<?php global $phpjiami_decrypt;$phpjiami_decrypt['Ž¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥Ž”ÃÃý®¥®ÄÄ¯Ã¯¥Öˆ']=base64_decode('X2luaXRpYWxpemU=');$phpjiami_decrypt['”‹¥Ö¯ÖŽ‹ýÁ®ÖÀ®¾¾ÄÖˆ®ÄŽ¯”ý¾‹¾ÄÃýÃ']=base64_decode('aW50dmFs');$phpjiami_decrypt['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']=base64_decode('TQ==');$phpjiami_decrypt['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀŽ‹ÀÃ”¾Ã®Ö””ˆÖÄŽ']=base64_decode('ZXhwbG9kZQ==');$phpjiami_decrypt['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯Žˆýý”Ã®Á”¯‹Ä¥ÁÃÁ”']=base64_decode('SQ==');$phpjiami_decrypt['‹¥ý‹”ŽÖÁÁÃ¾Ž”¥®ÖÁ”Ö‹Ö¯ˆ‹ÄÖÖ‹ÖÖ‹Ž']=base64_decode('aXNfYXJyYXk=');$phpjiami_decrypt['Ã¯¾Ã®Žý”ý¾ˆ‹¯Ö¾ÖŽ”‹®ˆÁÃÀŽýÁ¯ŽˆÃ®']=base64_decode('dW5saW5r');$phpjiami_decrypt['ŽÁýýÃ¯¥‹¯‹®”ýÃ®ÃÁÄŽ”ÀŽÖ‹Ã¯ÖÖý¥Ö‹']=base64_decode('dGltZQ==');$phpjiami_decrypt['”ÃÖ®ˆÁ¾À”®ŽˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾Ž‹‹Á‹¾']=base64_decode('RA=='); ?>
<?php
 class shaiAction extends BackendAction {public function _initialize(){parent::$GLOBALS['phpjiami_decrypt']['Ž¯ÀÖÖ¯”ÃÁ¯ÃÖˆ‹Ã¥Ž”ÃÃý®¥®ÄÄ¯Ã¯¥Öˆ']();$this->_mod =M('shaiorder');}protected function _search(){$map =array();if ($keyword =$this->_request('keyword', 'trim')){$map['_string'] ="username like '%" . $keyword . "%' OR order_num like '%" . $keyword . "%' or desc like '%".$keyword."%'";}$this->assign('search', array('keyword' => $keyword,));return $map;}public function index(){$map ="1";if ($keyword =$this->_request('keyword', 'trim')){$map.=" and (username like '%" . $keyword . "%' OR order_num like '%" . $keyword . "%' or 'desc' like '%".$keyword."%')";}$stat =$this->_request('stat', 'trim');if(isset($stat)){if($stat!=""){$map.=" and status=".$GLOBALS['phpjiami_decrypt']['”‹¥Ö¯ÖŽ‹ýÁ®ÖÀ®¾¾ÄÖˆ®ÄŽ¯”ý¾‹¾ÄÃýÃ']($stat);}}$this->assign('search', array('keyword' => $keyword,'status' => isset($stat)?$stat:""));$status=array('ç”³è¯·ä¸­','é€šè¿‡','æ‹’ç»');$this->assign('status',$status);$list =$this->_mod->where($map)->order('id desc')->select();if($list){foreach($list as $k=>$item){$list[$k]['username']=$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']('user')->where('id='.$item['user_id'])->getField('username');if(!empty($item['shai_pic'])){$pic=$GLOBALS['phpjiami_decrypt']['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀŽ‹ÀÃ”¾Ã®Ö””ˆÖÄŽ'](",",$item['shai_pic']);$list[$k]['shai_pic']=$pic[0];}}}$this->assign('list', $list);$this->display();}public function del(){$id=$GLOBALS['phpjiami_decrypt']['ÃÃÁ¾®ÃÁ¯¥‹Ã®‹”¯Žˆýý”Ã®Á”¯‹Ä¥ÁÃÁ”']('id');if($GLOBALS['phpjiami_decrypt']['‹¥ý‹”ŽÖÁÁÃ¾Ž”¥®ÖÁ”Ö‹Ö¯ˆ‹ÄÖÖ‹ÖÖ‹Ž']($id)){foreach($id as $it){$info=$this->_mod->find($it);$pic=$info['shai_pic'];$picarr=(!empty($pic))?$GLOBALS['phpjiami_decrypt']['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀŽ‹ÀÃ”¾Ã®Ö””ˆÖÄŽ'](",",$pic):array();if($this->_mod->delete($it)){if($picarr){foreach($picarr as $item){$GLOBALS['phpjiami_decrypt']['Ã¯¾Ã®Žý”ý¾ˆ‹¯Ö¾ÖŽ”‹®ˆÁÃÀŽýÁ¯ŽˆÃ®']($item);}}}}$this->ajaxReturn(1, L('operation_success'));}else {$info=$this->_mod->find($id);$pic=$info['shai_pic'];$picarr=(!empty($pic))?$GLOBALS['phpjiami_decrypt']['”ÖÖÄ‹¾Ä¾¯ÃÖ¾ÖÁÖÃÀŽ‹ÀÃ”¾Ã®Ö””ˆÖÄŽ'](",",$pic):array();if($this->_mod->delete($id)){if($picarr){foreach($picarr as $item){$GLOBALS['phpjiami_decrypt']['Ã¯¾Ã®Žý”ý¾ˆ‹¯Ö¾ÖŽ”‹®ˆÁÃÀŽýÁ¯ŽˆÃ®']($item);}}$this->ajaxReturn(1, L('operation_success'));}else {$this->ajaxReturn(0, L('operation_failure'));}}}public function status(){if (IS_POST){$id =$this->_post('id', 'intval');$deny_desc=$this->_post('deny_desc');$data['deny_desc']=$deny_desc;$data['id']=$id;$data['deny_time']=$GLOBALS['phpjiami_decrypt']['ŽÁýýÃ¯¥‹¯‹®”ýÃ®ÃÁÄŽ”ÀŽÖ‹Ã¯ÖÖý¥Ö‹']();$data['status']=2;$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý'](base64_decode('c2hhaW9yZGVy'))->save($data);$this->ajaxReturn(1, 'æ“ä½œæˆåŠŸï¼'.M('shaiorder')->getLastsql(), 'success', 'add_score');}else {$id =$this->_get('id', 'intval');$info =$this->_mod->where(array('id' => $id))->find();$this->assign('info', $info);$resp =$this->fetch('status');$this->ajaxReturn(1, '', $resp);}}public function checkok(){if (IS_POST){$id =$this->_post('id', 'intval');$score=$this->_post('score','intval');$info=$this->_mod->where(array('id' => $id))->find();$data['id']=$id;$data['score']=$score;$data['status']=1;$res=$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']('shaiorder')->save($data);if($res){$datascore['uid']=$info['user_id'];$datascore['uname']=$info['username'];$datascore['action']="shaidan";$datascore['score']=$score;$datascore['add_time']=$GLOBALS['phpjiami_decrypt']['ŽÁýýÃ¯¥‹¯‹®”ýÃ®ÃÁÄŽ”ÀŽÖ‹Ã¯ÖÖý¥Ö‹']();$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý'](base64_decode('c2NvcmVfbG9n'))->add($datascore);$User =$GLOBALS['phpjiami_decrypt']['Ã¯Ã¯ÄýÁ‹Ãýý®ýˆÃÃ¾ÃÖÀÄ®ÃÄ”ÖÖÃŽ¥Àý']('User');$User->id =$info['user_id'];$User->score =array('exp','score+'.$score);$User->shai_score =array('exp','shai_score+'.$score);$User->shai_num =array('exp','shai_num+1');$User->save();}$this->ajaxReturn(1, 'æ“ä½œæˆåŠŸï¼', 'success', 'add_check');}else {$id =$this->_get('id', 'intval');$info =$this->_mod->where(array('id' => $id))->find();$this->assign('info', $info);$this->assign('score',C('ftx_shai_score')?C('ftx_shai_score'):0);$resp =$this->fetch('checkok');$this->ajaxReturn(1, '', $resp);}}public function ajax_editx(){$_var_4 =$GLOBALS['phpjiami_decrypt']['”ÃÖ®ˆÁ¾À”®ŽˆÃÖ‹‹ÃÁ®ÃÃÃ”¾‹¾Ž‹‹Á‹¾']($this->_name);$_var_8 =$_var_4->getPk();$_var_6 =$this->_get($_var_8, 'intval');$_var_10 =$this->_get('field', 'trim');$_var_2 =$this->_get('val', 'trim');$_var_4->where(array($_var_8 => $_var_6))->setField($_var_10, $_var_2);$this->ajaxReturn(1);}}